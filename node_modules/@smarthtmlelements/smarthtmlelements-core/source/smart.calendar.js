
/* Smart HTML Elements v1.1.0 (2018-June) 
Copyright (c) 2011-2018 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-calendar",class extends Smart.BaseElement{static get properties(){return{animationSettings:{value:null,type:"object"},calendarMode:{value:"default",allowedValues:["default","classic"],type:"string"},dayNameFormat:{value:"firstTwoLetters",allowedValues:["narrow","firstTwoLetters","long","short"],type:"string"},dateFormatFunction:{value:null,type:"function"},disableAutoNavigation:{value:!1,type:"boolean"},displayMode:{value:"month",allowedValues:["month","year","decade"],type:"string"},displayModeView:{value:"table",allowedValues:["table","list"],type:"string"},dropDownHeight:{value:"100",type:"string"},dropDownWidth:{value:"",type:"string"},firstDayOfWeek:{value:0,type:"number",defaultValue:0,validator:"_firstDayOfWeekValidator"},footerTemplate:{value:null,type:"any"},headerTemplate:{value:null,type:"any"},hideDayNames:{value:!1,type:"boolean"},hideOtherMonthDays:{value:!1,type:"boolean"},hideTooltipArrow:{value:!1,type:"boolean"},importantDates:{value:[],type:"array",defaultValue:[]},importantDatesTemplate:{value:null,type:"any"},max:{value:new Date(2100,1,1),type:"any",defaultValue:new Date(2100,1,1)},min:{value:new Date(1900,1,1),type:"any",defaultValue:new Date(1900,1,1)},months:{value:1,type:"number",defaultValue:1,validator:"_monthsValidator"},monthNameFormat:{value:"long",allowedValues:["narrow","firstTwoLetters","long","short","2-digit","numeric"],type:"string"},name:{value:"",type:"string"},restrictedDates:{value:[],type:"array",defaultValue:[]},scrollButtonsNavigationMode:{value:"landscape",allowedValues:["portrait","landscape"],type:"string"},scrollButtonsPosition:{value:"both",allowedValues:["near","far","both"],type:"string"},selectedDates:{value:[],type:"array"},selectionMode:{value:"default",allowedValues:["none","default","one","many","zeroOrMany","oneOrMany","zeroOrOne","week"],type:"string"},spinButtonsDelay:{value:80,type:"number"},spinButtonsInitialDelay:{value:0,type:"number"},titleTemplate:{value:null,type:"any"},tooltip:{value:!1,type:"boolean"},tooltipDelay:{value:100,type:"number"},tooltipPosition:{value:"top",allowedValues:["bottom","top","left","right","absolute"],type:"string"},tooltipTemplate:{value:null,type:"any"},view:{value:"portrait",allowedValues:["landscape","portrait"],type:"string"},viewSections:{value:["header"],type:"array"},weekNumbers:{value:!1,type:"boolean"},weeks:{value:6,type:"number",defaultValue:6,validator:"_weeksValidator"},yearFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"}}}static get listeners(){return{"container.down":"_downHandler","document.up":"_documentUpHandler","container.move":"_moveHandler","container.wheel":"_containerWheelHandler","content.focus":"_contentStateHandler","content.blur":"_contentStateHandler","header.click":"_headerClickHandler","header.change":"_headerChangeHandler",keydown:"_keyDownHandler",keyup:"_keyUpHandler","listViewContainer.keydown":"_listViewContainerKeyDownHandler","listViewContainer.change":"_listViewContainerChangeEventHandler",mouseenter:"_mouseEventsHandler",mouseleave:"_mouseEventsHandler",mouseover:"_mouseEventsHandler",mouseout:"_mouseEventsHandler"}}template(){return`<div id="container">
                    <div id="title" class="smart-calendar-title">
                        <div id="yearContainer" class="smart-year-container"></div>
                        <div id="dateContainer" class="smart-date-container smart-selected"></div>
                    </div>
                    <div id="calendarContainer" class="smart-calendar-container">
                        <div id="header" class ="smart-header">
                            <smart-repeat-button class="smart-previous-month-button" id="previousMonthButton" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]">
                                <div class ="smart-arrow">&#xe809</div>
                            </smart-repeat-button>
                            <div id="dateElement" class ="smart-date-element">
                                <div id="defaultHeaderDate"></div>
                                <div id="classicHeaderDate">
                                    <smart-drop-down-list class ="smart-month-element" id="monthElement" drop-down-position="bottom" selection-mode="one" disabled="[[disabled]]" readonly="[[readonly]]" drop-down-width="[[dropDownWidth]]" drop-down-height="[[dropDownHeight]]">
                                    </smart-drop-down-list>
                                    <input class ="smart-year-element" id="yearElement" disabled="[[disabled]]" readonly="[[readonly]]"/>
                                    <span class ="smart-year-elements">
                                        <smart-repeat-button class ="smart-increment-year-button" id="incrementYearButton" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]">
                                            <span class ="smart-arrow">&#xe801</span>
                                        </smart-repeat-button>
                                        <smart-repeat-button class ="smart-decrement-year-button" id="decrementYearButton" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]">
                                            <span class ="smart-arrow">&#xe804</span>
                                        </smart-repeat-button>
                                    </span>
                                </div>
                            </div>
                            <smart-repeat-button class ="smart-next-month-button" id="nextMonthButton" initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" disabled="[[disabled]]" readonly="[[readonly]]">
                                <div class ="smart-arrow">&#xe810</div>
                            </smart-repeat-button>
                        </div>
                        <div id="content" class ="smart-content">
                           <div id="monthsContainer" class="smart-months-container">
                              <div id="month" class="smart-calendar-month">
                                   <div id="monthName" class="smart-month-name"></div>
                                   <div id="weekTitles" class="smart-calendar-week-titles">
                                       <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                                   </div>
                                   <div id="weeks">
                                        <div class="smart-calendar-week">
                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                                        </div>
                                        <div class ="smart-calendar-week">
                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                                       </div>
                                       <div class="smart-calendar-week">
                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                                       </div>
                                       <div class="smart-calendar-week">
                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                                       </div>
                                       <div class="smart-calendar-week">
                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                                       </div>
                                       <div class ="smart-calendar-week">
                                           <div class ="smart-week-number"></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                                       </div>
                                   </div>
                                </div>
                            </div>
                            <div id="dateViewContainer" class="smart-date-view-container smart-hidden">
                                <div></div><div></div><div></div><div></div><div></div><div></div>
                                <div></div><div></div><div></div><div></div><div></div><div></div>
                            </div>
                            <div id="monthsSeparator" class="smart-calendar-month-separator"></div>
                            <div id="nextMonthsContainer" class="smart-next-months-container"></div>
                            <smart-list-box item-height="30" unfocusable virtualized id="listViewContainer" selection-mode="one" class="smart-list-view smart-hidden"></smart-list-box>
                            <div id="animationPanel" class="smart-calendar-animation-panel smart-hidden"></div>
                        </div>
                        <div id="footer" class ="smart-footer smart-hidden">
                            <div id="selectedDatesRange"></div>
                        </div>
                        <smart-tooltip id="tooltip" open-mode="manual" arrow
                                   tooltip-template="[[tooltipTemplate]]"
                                   position="[[tooltipPosition]]"
                                   delay="[[tooltipDelay]]"
                                   disabled="[[disabled]]">
                         </smart-tooltip>
                        <input id="hiddenInput" type="hidden" name="[[name]]">
                    </div>
                </div>`}propertyChangedHandler(e,t,a){super.propertyChangedHandler(e,t,a);const n=this;switch(e){case"animationSettings":n._applyAnimationSettings();break;case"disabled":case"unfocusable":n._setFocusable();break;case"calendarMode":n.displayMode="month",n._setCalendarMode(),n._setDisplayModeContent();break;case"dayNameFormat":n._setDayNames(n.$.month);break;case"dateFormatFunction":{let e=n.$.monthsContainer.children;for(let t=0;t<e.length;t++)e[t].firstElementChild.innerHTML=a?a(e[t]._date):n._monthsNames[e[t]._date.getMonth()]+" "+e[t]._date.toLocaleDateString(n.locale,{year:n.yearFormat});n._setHeader();break}case"displayMode":n._setDisplayMode(t,a);break;case"displayModeView":n._applyAnimationSettings(!0),"month"!==n.displayMode&&n._setDisplayModeContent();break;case"firstDayOfWeek":n._handleMonths(),n._setDayNames();break;case"hideTooltipArrow":n.$.tooltip.arrow=!a;break;case"titleTemplate":case"headerTemplate":case"footerTemplate":n._handleLayoutTemplate(n.$[e.split(/[T]/)[0]],a),"titleTemplate"===e?n._setTitle():"headerTemplate"===e?n._setHeader():n._setFooter();break;case"importantDates":n.importantDates=n._validateDate(a),n._setImportantDates();break;case"importantDatesTemplate":n._handleImportantDateTemplate(),n._setImportantDates();break;case"locale":n._setMonthNames(),n._setDayNames(),n._setHeader(),n._setTitle(),n._setFooter(),n.displayMode&&"month"!==n.displayMode&&n._setDisplayModeContent();break;case"max":case"min":n._validateMinMax(e,a,t),n._validateSelectedDates(),n._noFocusingRequired=!1,n._updateHeaderElements();break;case"months":n._handleMonths();break;case"monthNameFormat":n._setCalendarMode(),n._setHeader();break;case"restrictedDates":n._setRestrictedDates(n.restrictedDates=n._validateDate(a));break;case"rightToLeft":n._setDayNames(),n._handleMonths();break;case"scrollButtonsNavigationMode":n._setScrollButtonsNavigationMode();break;case"selectedDates":if(n._clearSelection(!0),n._validateSelectedDates(n._validateDate(a)),n._applySelectionMode(!0),n._dateInView){let e=n.selectedDates[n.selectedDates.length-1];n._isDateInView(e)?n.selectedDates.map(e=>n._selectDate(e,!0,!0)):n._handleMonths(e)}n._setFooter(),n._setWeeksVisibility(n.$.monthsContainer),n.$.hiddenInput.value=n.selectedDates.toString(),n.$.fireEvent("change",{value:n.selectedDates}),n._setTitle();break;case"selectionMode":n._applySelectionMode(),n._setTitle();break;case"view":n._setTitle();break;case"viewSections":-1<a.indexOf("title")?n.$title.removeClass("smart-hidden"):n.$title.addClass("smart-hidden"),n._setTitle(),-1<a.indexOf("header")?n.$header.removeClass("smart-hidden"):n.$header.addClass("smart-hidden"),n._setHeader(),-1<a.indexOf("footer")?n.$footer.removeClass("smart-hidden"):n.$footer.addClass("smart-hidden"),n._setFooter();break;case"weeks":n._setWeeksVisibility(n.$.monthsContainer);break;case"yearFormat":if(n._setCalendarMode(),n._setFooter(),1<n.months&&"month"===n.displayMode){let e=n._animationStarted?n.$.nextMonthsContainer.children:n.$.monthsContainer.children;for(let t=0;t<e.length;t++)e[t].firstElementChild.innerHTML=n.dateFormatFunction?n.dateFormatFunction(e[t]._date):n._monthsNames[e[t]._date.getMonth()]+" "+e[t]._date.toLocaleDateString(n.locale,{year:a})}n._setTitle(),n._setHeader();}}ready(){super.ready();const e=this;e._applyAnimationSettings(),e.importantDates=e._validateDate(e.importantDates),e.restrictedDates=e._validateDate(e.restrictedDates),e._setMonthNames(),e._validateMinMax(),e._validateSelectedDates(e._validateDate(e.selectedDates)),e._handleLayoutTemplate(e.$.title,e.titleTemplate),e._handleLayoutTemplate(e.$.header,e.headerTemplate),e._handleLayoutTemplate(e.$.footer,e.footerTemplate),e._handleImportantDateTemplate(),e._keysPressed={},e._setFocusable(),e._setDayNames(),e._applySelectionMode(!0),e._handleMonths(0===e.selectedDates.length?new Date(new Date().setHours(0,0,0,0)):e.selectedDates[e.selectedDates.length-1]),-1<e.viewSections.indexOf("title")?e.$title.removeClass("smart-hidden"):e.$title.addClass("smart-hidden"),-1<e.viewSections.indexOf("header")?e.$header.removeClass("smart-hidden"):e.$header.addClass("smart-hidden"),-1<e.viewSections.indexOf("footer")?e.$footer.removeClass("smart-hidden"):e.$footer.addClass("smart-hidden"),e._setScrollButtonsNavigationMode(),e._setCalendarMode(),e._setDisplayMode(),e._setTitle(),e._setFooter(),e.$.monthElement&&e.$.monthElement._setDropDownSize()}clearSelection(){this._clearSelection()}_setFocusable(){function e(e,n){if(n){let i=t.$.header.getElementsByClassName(e.className)[0];if(i&&i instanceof n)return"function"==typeof i._setFocusable&&i.isCompleted?i.unfocusable=-1>=a:i.setAttribute("tabindex",a),i}}const t=this;let a=0<t.tabIndex?t.tabIndex:0;(t.disabled||t.readonly||t.unfocusable)&&(a=-1),t.$.previousMonthButton=e(t.$.previousMonthButton,Smart.Button),t.$.nextMonthButton=e(t.$.nextMonthButton,Smart.Button),t.$.incrementYearButton=e(t.$.incrementYearButton,Smart.Button),t.$.decrementYearButton=e(t.$.decrementYearButton,Smart.Button),t.$.monthElement=e(t.$.monthElement,Smart.DropDownList),t.$.yearElement=e(t.$.yearElement,HTMLInputElement),-1<t.viewSections.indexOf("title")&&(t.$.dateContainer.setAttribute("tabindex",a),t.$.yearContainer.setAttribute("tabindex",a)),t.$.content.setAttribute("tabindex",a),t.$.dateElement.setAttribute("tabindex","default"===t.calendarMode?a:-1),t.tabIndex=t.readonly&&!t.disabled?0<t.tabIndex?t.tabIndex:0:a}static get requires(){return{"Smart.Tooltip":"smart.tooltip.js"}}navigate(e){const t=this;if(e=parseInt(e),!isNaN(e)){const a=t._getNextDate(e);if(a)return"month"===t.displayMode?(t.$.hasClass("animation")?(t._animateNavigation(a,e),t.$nextMonthsContainer.hasClass("smart-date-view-container")&&t.$nextMonthsContainer.removeClass("smart-date-view-container")):(t._handleMonths(a),t._updateHeaderElements(),t._setHeader()),!0):(t.$.hasClass("animation")?(t.$nextMonthsContainer.addClass("smart-date-view-container"),"list"===t.displayModeView?t._setDisplayModeContent(a):t._animateNavigation(a,e)):t._setDisplayModeContent(a),!0)}}select(e){const t=this;"undefined"!=typeof t._dateInView[0]&&"none"!==t.selectionMode&&e&&(e=t._validateDate(e)[0],!(e instanceof Date)||"one"===t.selectionMode&&-1<t.selectedDates.map(Number).indexOf(e.getTime())||e.getTime()<t.min.getTime()||e.getTime()>t.max.getTime()||(("one"===t.selectionMode||"default"===t.selectionMode||"zeroOrOne"===t.selectionMode)&&t._clearSelection(!0),t._selectDate(e),1===t.selectedDates.length&&!t._isDateInView(t.selectedDates[0])&&t._handleMonths(t.selectedDates[0])))}today(){const e=this;let t=new Date;return t.setHours(0,0,0,0),t.getTime()<e.min.getTime()||t.getTime()>e.max.getTime()?t=new Date(e.max):e.selectedDates=[t],e._handleMonths(t),t}_animateNavigation(e,t,a){function n(){let e=0<t?o.$.content[o._animationSettings.scrollSize]>=r:0===o.$.content[o._animationSettings.scrollSize],a=o._scrollStep/2;return e?void o._animateNavigationCompleted():void(0<t&&o.$.content[o._animationSettings.scrollSize]>r*o._animationSettings.easeThreshold?(a=i(o.$.content[o._animationSettings.scrollSize]/o._animationSettings.stepEaseSize,s(a-(r-o.$.content[o._animationSettings.scrollSize])*o._animationSettings.step)),o._scrollStep=o._scrollStep*o._animationSettings.step+a):0>t&&o.$.content[o._animationSettings.scrollSize]<r*o._animationSettings.easeThreshold&&(a=i(o.$.content[o._animationSettings.scrollMax]/o._animationSettings.stepEaseSize,s(a-o.$.content[o._animationSettings.scrollSize]*o._animationSettings.step)),o._scrollStep=o._scrollStep*o._animationSettings.step+a),o.$.content[o._animationSettings.scrollSize]+=0<t?o._scrollStep:-o._scrollStep,o._animationId=requestAnimationFrame(n))}var i=Math.max,s=Math.abs;const o=this;o._animationSettings||o._applyAnimationSettings(),o.$animationPanel.addClass("smart-hidden"),o.$.dateViewContainer.style.transform="",o.$.dateViewContainer.style.opacity="",o.$.monthsContainer.style.transform="",o.$.monthsContainer.style.opacity="";const l="month"===o.displayMode?o.$.monthsContainer:o.$.dateViewContainer,r=o.$.content[o._animationSettings.scrollMax]-o.$.content[o._animationSettings.size];o._scrollStep=o.$.content[o._animationSettings.size]*o._animationSettings.startSpeed,o._animationStarted=!0,"month"===o.displayMode?o._handleMonths(e,o.$.nextMonthsContainer):(o._focusedDate.focused=!1,o._focusedDate.removeAttribute("focused"),o._setDisplayModeContent(e,o.$.nextMonthsContainer)),a||(0<t?(l.style.order=1,o.$.nextMonthsContainer.style.order=3,(!o._animationStarted||o._animationStarted&&o.$.content[o._animationSettings.scrollSize]>2*(o.$.content[o._animationSettings.scrollMax]*o._animationSettings.resetThreshold))&&(o.$.content[o._animationSettings.scrollSize]=0)):(l.style.order=3,o.$.nextMonthsContainer.style.order=1,(!o._animationStarted||o._animationStarted&&o.$.content[o._animationSettings.scrollSize]<o.$.content[o._animationSettings.scrollMax]*o._animationSettings.resetThreshold)&&(o.$.content[o._animationSettings.scrollSize]=o.$.content[o._animationSettings.scrollMax]))),cancelAnimationFrame(o._animationId),o._animationId=requestAnimationFrame(n)}_animateNavigationCompleted(){const e=this;let t="month"===e.displayMode?e.$.monthsContainer:e.$.dateViewContainer;cancelAnimationFrame(e._animationId);let a=e._focusedDate?e._focusedDate.value:void 0;a&&(e._focusedDate.focused=!1,e._focusedDate.removeAttribute("focused"));let n,s;if("month"!==e.displayMode){t.innerHTML=e.$.nextMonthsContainer.innerHTML,n=t.children,s=e.$.nextMonthsContainer.children;for(let e=0;e<n.length;e++)n[e].value=s[e].value}else{let a=t.children,o=e.$.nextMonthsContainer.children;for(let t=0;t<a.length;t++){a[t]._date=o[t]._date,a[t].innerHTML=o[t].innerHTML,n=e._getMonthDays(a[t]).days,s=e._getMonthDays(o[t]).days;for(let e=0;e<n.length;e++)n[e].value=s[e].value}0<e._selectedDates.length&&(e._selectedDates=e._selectedDates.map(t=>t=e._getDayInstanceByValue(t.value)).filter(e=>"undefined"!=typeof e))}e._focusDate(e._getDayInstanceByValue(a)),t.style.order=1,e.$.nextMonthsContainer.style.order=3,e.$.content[e._animationSettings.scrollSize]=0,e._animationStarted=!1}_applyAnimationSettings(e){const t=this;if(!t.$.hasClass("animation"))return void delete t._animationSettings;t._animationSettings=t.animationSettings?t.animationSettings:t._animationSettings?t._animationSettings:{},"portrait"===t.scrollButtonsNavigationMode?(t._animationSettings.scrollMax="scrollHeight",t._animationSettings.size="offsetHeight",t._animationSettings.scrollSize="scrollTop"):(t._animationSettings.scrollMax="scrollWidth",t._animationSettings.size="offsetWidth",t._animationSettings.scrollSize="scrollLeft");e||(t._animationSettings.startSpeed=t._animationSettings.startSpeed?t._animationSettings.startSpeed:.2,t._animationSettings.easeThreshold=t._animationSettings.easeThreshold?t._animationSettings.easeThreshold:.5,t._animationSettings.step=t._animationSettings.step?t._animationSettings.step:.25,t._animationSettings.stepEaseSize=t._animationSettings.stepEaseSize?t._animationSettings.stepEaseSize:200,t._animationSettings.resetThreshold=t._animationSettings.resetThreshold?t._animationSettings.resetThreshold:.2)}_applySelectionMode(e){var t=Math.min,a=Math.max;const n=this;let s=[],i=!!e;switch(n.selectionMode){case"none":return void n._clearSelection(i);case"many":case"default":case"oneOrMany":if(0===n.selectedDates.length){s.push(new Date(t(a(n.min.getTime(),new Date().setHours(0,0,0,0)),n.max.getTime())));break}return;case"one":if(1===n.selectedDates.length)return;1<n.selectedDates.length?(s.push(n.selectedDates[n.selectedDates.length-1]),n._clearSelection(i)):s.push(new Date(t(a(n.min.getTime(),new Date().setHours(0,0,0,0)),n.max.getTime())));break;case"zeroOrOne":if(1<n.selectedDates.length){s.push(n.selectedDates[n.selectedDates.length-1]),n._clearSelection(i);break}return;case"zeroOrMany":return;case"week":if(1<=n.selectedDates.length){let e=n.selectedDates[n.selectedDates.length-1];for(let t=0;8>t;t++)s.push(new Date(e)),e.setDate(e.getDate()+1);n._clearSelection(i)}}if(n.selectedDates=[],e)return void(n.selectedDates=s);const o=s.length;for(let t=0;t<o;t++)n._selectDate(s[t],t<o-1)}_clearSelection(e){const t=this;if(t._selectedDates&&t._selectedDates.map(e=>{e.selected=!1,e.removeAttribute("selected")}),t.selectedDates=[],t._selectedDates=[],"many"===t.selectionMode){const e=t.$.monthsContainer.children;for(let a=0;a<e.length;a++)t._getMonthDays(e[a]).days.map(e=>e.classList.remove("hovered"))}t._setFooter(),t.$.hiddenInput.value=t.selectedDates.toString(),e||t.$.fireEvent("change",{value:[]}),t._setTitle()}_contentStateHandler(e){const t=this;return"blur"===e.type||"focus"===e.type&&t._noFocusingRequired?(t._noFocusingRequired=!1,t._focusedDate.focused=!1,void t._focusedDate.removeAttribute("focused")):"month"===t.displayMode?void("focus"===e.type&&t._focusDate()):void(t._focusedDate&&t._focusedDate instanceof HTMLDivElement&&t._focusedDate.setAttribute("focused",""))}_containerWheelHandler(e){const t=this;if(t.disabled||t.readonly)return;let a;t.$.yearElement===document.activeElement&&(a=12),document.activeElement.closest("smart-calendar")===t&&(a=e.target===t.$.yearElement?12:1);a&&(e.preventDefault(),a=12==a?a:a*t.months,0<e.deltaY?t.navigate(-a):t.navigate(a))}_downHandler(e){const t=this;let a=e.originalEvent.target;if(t._dragStartDetails=void 0,!(t.disabled||t.readonly)){if(-1<t.theme.indexOf("material")&&(a.value instanceof Date||a.parentElement&&a.parentElement.classList.contains("smart-calendar-title")||a.parentElement===t.$.dateElement||a.closest("smart-repeat-button"))&&Smart.Utilities.Animation.Ripple.animate(a,e.pageX,e.pageY),a=e.originalEvent.target.closest(".smart-header"),e.originalEvent.target.closest(".smart-year-container")&&"decade"!==t.displayMode)return void t._showDateView("year");if(e.originalEvent.target.closest(".smart-date-container")&&"month"!==t.displayMode)return void t._displayModeHandler("list"===t.displayModeView?t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]):t._focusedDate,"month");if(t._animationStarted&&t._animateNavigationCompleted(),Smart.Utilities.Core.isMobile&&!(a&&a===t.$.header))return void(t._dragStartDetails={x:e.pageX,y:e.pageY,startTime:Date.now(),target:e.originalEvent.target});if(a=e.originalEvent.target,a.closest(".smart-calendar-week")||a.parentElement===t.$.dateViewContainer){for(;a&&!(a.value instanceof Date);)a=a.parentElement;return void(a&&("month"===t.displayMode?t._weeksDownHandler(a):t._displayModeHandler(a)))}return e.originalEvent.stopPropagation(),"list"===t.displayModeView&&"month"!==t.displayMode?(a=e.originalEvent.target.closest("smart-list-item"),void(a&&t._displayModeHandler(a))):void t.focus()}}_displayModeHandler(e,t){const a=this;if(e instanceof HTMLElement&&e.parentElement.classList.contains("smart-calendar-week")&&e.classList.contains("smart-other-month-date")){if("decade"===a.displayMode&&(e.value.getFullYear()<a.min.getFullYear()||e.value.getFullYear()>a.max.getFullYear()))return;if("year"===a.displayMode&&(e.value.getFullYear()<a.min.getFullYear()||e.value.getFullYear()===a.min.getFullYear()&&e.value.getMonth()<a.min.getMonth()||e.value.getFullYear()>a.max.getFullYear()||e.value.getFullYear()===a.max.getFullYear()&&e.value.getMonth()>a.max.getMonth()))return}if(t=t?t:a.displayMode,"year"===t?t="month":"decade"===t?t="year":void 0,a.displayMode!==t){const n=a.$.fireEvent("displayModeChanging",{oldDisplayMode:a.displayMode,newDisplayMode:t}).defaultPrevented;n||(a.displayMode=t,e.parentElement===a.$.dateViewContainer&&!e.disabled&&!e.restricted&&a._focusDate(e),a.$.hasClass("animation")?(e instanceof Smart.ListItem||e.ownerListBox===a.$.listViewContainer?e.offsetHeight?a.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(0<e.dataItem.top?e.offsetTop-e.offsetHeight/2:e.offsetTop+e.offsetHeight/2)+"px":a.$.animationPanel.style.transformOrigin=a.$.listViewContainer.offsetLeft+a.$.listViewContainer.offsetWidth/2+"px "+(a.$.listViewContainer.offsetTop+a.$.listViewContainer.offsetHeight/2)+"px":(e=a._focusedDate,a.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(e.offsetTop+e.offsetHeight/2)+"px"),a._animateView(1,e)):a._setDisplayModeContent(e.value instanceof Date?e.value:new Date(e.value)))}}_animateView(e,t){function a(){return(0<e&&3.5<=d||0>e&&0>=d)&&(r=!0),r?(cancelAnimationFrame(i._animationId),i.$animationPanel.addClass("smart-hidden"),i.$.animationPanel.style.transform="",i.$.animationPanel.style.opacity="",o.style.transform="",o.style.opacity="",void("month"===i.displayMode?i.$.content.focus():"list"===i.displayModeView&&i.focus())):void(i.$.animationPanel.style.opacity=m,o.style.opacity=1-m,m-=.05,0<e?(i.$.animationPanel.style.transform="scale("+d+")",o.style.transform="scale("+Math.min((d-1)/2,1)+")",d+=.125):(i.$.animationPanel.style.transform="scale("+n(d,0)+")",o.style.transform="scale("+n(1+d,1)+")",d-=.06),i._animationId=requestAnimationFrame(a))}var n=Math.max;const i=this;let s,o,l=t instanceof Date?t:new Date(t.value),r=!1,d=1,m=1;if("list"===i.displayModeView?(s=t instanceof Smart.ListItem||t.ownerListBox===i.$.listViewContainer?i.$.listViewContainer:"month"===i.displayMode?i.$.listViewContainer:i.$.monthsContainer,o="month"===i.displayMode?i.$.monthsContainer:i.$.listViewContainer):!(t.value instanceof Date)&&(t=i._focusedDate?i._focusedDate:0<i._selectedDates.length?i._selectedDates[i._selectedDates.length-1]:i._getDayInstanceByValue(new Date)),s||(s=t.parentElement===i.$.dateViewContainer?i.$.dateViewContainer:i.$.monthsContainer),o||(o="month"===i.displayMode?i.$.monthsContainer:i.$.dateViewContainer),o.style.transformOrigin=i.$.animationPanel.style.transformOrigin,s instanceof Smart.ListBox?(i.$.animationPanel.innerHTML="",i.$.animationPanel.appendChild(s.cloneNode(!1)),i.$.animationPanel.children[0].insert(0,Array.from(s.$.itemsInnerContainer.children))):i.$.animationPanel.innerHTML=s.innerHTML,i._setDisplayModeContent(l),i.$.animationPanel.style.width=i.$.content.offsetWidth+"px",i.$.animationPanel.style.height=i.$.content.offsetHeight+"px",i.$.animationPanel.style.transform="scale(1)",i.$.animationPanel.style.opacity=1,i.$animationPanel.removeClass("smart-hidden"),o.style.opacity="0",o.style.transform="scale(3.5)",s.$.hasClass("smart-date-view-container")?i.$animationPanel.addClass("smart-date-view-container"):i.$animationPanel.removeClass("smart-date-view-container"),s instanceof Smart.ListBox){const e=i.$.animationPanel.children[0];e.whenReady(function(){e._refreshLayout(),e.ensureVisible(e.selectedValues[0])})}cancelAnimationFrame(i._animationId),i._animationId=requestAnimationFrame(a)}_documentUpHandler(e){var t=Math.abs;const a=this;if(!Smart.Utilities.Core.isMobile||!a._dragStartDetails)return;const n=Date.now();let i=e.originalEvent.target,s={};if("portrait"===a.scrollButtonsNavigationMode?(s.coordinate="y",s.direction="pageY"):(s.coordinate="x",s.direction="pageX"),10>=t(a._dragStartDetails[s.coordinate]-e[s.direction])){if(i="list"===a.displayModeView&&"month"!==a.displayMode?i.closest("smart-list-item"):i,!i)return void(a._dragStartDetails=void 0);if("month"!==a.displayMode)return a._displayModeHandler(i),"portrait"===a.scrollButtonsNavigationMode?a.$.content.scrollTop=0:a.$.content.scrollLeft=0,void(a._dragStartDetails=void 0);if(a._weeksDownHandler(i),!a.disableAutoNavigation&&i.classList.contains("smart-other-month-date"))return}else{const i=t((e[s.direction]-a._dragStartDetails[s.coordinate])/(n-a._dragStartDetails.startTime));if(1<i){const e=parseInt(i);for(let t=0;t<e;t++)a.navigate(a._dragStartDetails.step);return void(a._dragStartDetails=void 0)}}if(!a.$.hasClass("animation"))return void(a._dragStartDetails=void 0);let o=("month"===a.displayMode?a.$.monthsContainer[a._animationSettings.scrollMax]:a.$.dateViewContainer[a._animationSettings.scrollMax])+a.$.monthsSeparator[a._animationSettings.size];return 0<a._dragStartDetails.step&&a.$.content[a._animationSettings.scrollSize]>o*a._animationSettings.easeThreshold||0>a._dragStartDetails.step&&a.$.content[a._animationSettings.scrollSize]<o*a._animationSettings.easeThreshold?(a._animateNavigation(a._dragStartDetails.navigationDate,a._dragStartDetails.step,!0),void(a._dragStartDetails=void 0)):void(a._animateMonthRepositioning(void 0,a._dragStartDetails.step),a._dragStartDetails=void 0)}_animateMonthRepositioning(e,t){function a(){let e=0>t?s.$.content[s._animationSettings.scrollSize]>=l:0===s.$.content[s._animationSettings.scrollSize],r=s._scrollStep/2;return e?(cancelAnimationFrame(s._animationId),o.style.order=1,s.$.nextMonthsContainer.style.order=3,s.$.content[s._animationSettings.scrollSize]=0,void(s._animationStarted=!1)):void(0<t?(r=n(s.$.content[s._animationSettings.scrollMax]/s._animationSettings.stepEaseSize,i(r-s.$.content[s._animationSettings.scrollSize]*s._animationSettings.step)),s._scrollStep=s._scrollStep*s._animationSettings.step+r):(r=n(s.$.content[s._animationSettings.scrollMax]/s._animationSettings.stepEaseSize,i(r-(l-s.$.content[s._animationSettings.scrollSize])*s._animationSettings.step)),s._scrollStep=s._scrollStep*s._animationSettings.step+r),s.$.content[s._animationSettings.scrollSize]+=0>t?s._scrollStep:-s._scrollStep,s._animationId=requestAnimationFrame(a))}var n=Math.max,i=Math.abs;const s=this,o="month"===s.displayMode?s.$.monthsContainer:s.$.dateViewContainer;s._animationSettings||s._applyAnimationSettings();const l=o[s._animationSettings.scrollMax]+s.$.monthsSeparator[s._animationSettings.size];s._scrollStep=s.$.content[s._animationSettings.size]*s._animationSettings.startSpeed,cancelAnimationFrame(s._animationId),s._animationId=requestAnimationFrame(a),s._animationStarted=!0}_focusDate(e){const t=this;if(t._focusedDate&&(t._focusedDate.focused=!1,t._focusedDate.removeAttribute("focused")),!(t.disabled||t.readonly)){if(e)return"month"===t.displayMode?e.disabled||e.restricted?void 0:(e.focused=!0,e.setAttribute("focused",""),t._focusedDate=e,void t._updateWeeksVisibility(t._focusedDate)):(e.focused=!0,e.setAttribute("focused",""),void(t._focusedDate=e));if("month"===t.displayMode||0!==t.$.monthsContainer.offsetHeight){if(0<t._selectedDates.length)t._selectedDates[t._selectedDates.length-1].focused=!0,t._selectedDates[t._selectedDates.length-1].setAttribute("focused",""),t._focusedDate=t._selectedDates[t._selectedDates.length-1];else{const e=t.$.monthsContainer.children;if(t.min.getTime<e[0]._date.getTime())return;let a=t._getMonthDays(e[0],t.rightToLeft).days;for(let e=0;e<a.length;e++)if(0===a[e].classList.length){if(a[e].disabled||a[e].restricted)continue;t._focusedDate=a[e];break}}t._focusedDate&&(t._focusedDate.focused=!0,t._focusedDate.setAttribute("focused",""),t._updateWeeksVisibility(t._focusedDate))}}}_getDays(e,t){const a=t.length;let n=[];if(0<a)for(let i=0;i<a;i++)t[i].getFullYear()===e.getFullYear()&&t[i].getMonth()===e.getMonth()&&n.push(t[i].getDate());return n}_getDayInstanceByValue(e,t){const a=this;if(!(e instanceof Date))return;if(t||(t=a.$.monthsContainer),"month"!==a.displayMode){if("list"===a.displayModeView)return;let t=arguments[1]?a.$.nextMonthsContainer.children:a.$.dateViewContainer.children;for(let n=0;n<t.length;n++)if("year"===a.displayMode){if(t[n].value.getMonth()===e.getMonth())return t[n];continue}else if(t[n].value.getFullYear()===e.getFullYear())return t[n];return}let n,s,o=t.children;for(let a=0;a<o.length;a++)if(e.getFullYear()===o[a]._date.getFullYear()&&e.getMonth()===o[a]._date.getMonth()){n=o[a];break}if(n){s=a._getMonthDays(n).days;for(let t=0;t<s.length;t++)if(!(s[t].hasAttribute("class")&&0<s[t].getAttribute("class").length&&!s[t].classList.contains("hovered"))&&s[t].value.getDate()===e.getDate())return s[t]}}_getMonthDays(e,t){let a=e.getElementsByClassName("smart-calendar-week"),n=a.length,i=[];if(t)for(let e,t=0;t<n;t++){e=a[t].children;for(let t=e.length-1;0<t;t--)i.push(e[t])}else for(let e,t=0;t<n;t++){e=a[t].children;for(let t=1;t<e.length;t++)i.push(e[t])}return{days:i,weeks:[].slice.call(a)}}_getWeekNumber(e){var t=Math.round;const a=this;let n,i=new Date(e.getFullYear(),0,1),s=t((e.getTime()-i.getTime()-6e4*(e.getTimezoneOffset()-i.getTimezoneOffset()))/864e5)+1,o=i.getDay()-a.firstDayOfWeek;return o=0<=o?o:o+7,4>o?(n=Math.floor((s+o-1)/7)+1,52<n&&(i=new Date(e.getFullYear()+1,0,1),o=i.getDay()-a.firstDayOfWeek,o=0<=o?o:o+7,n=4>o?1:53)):n=t((s+o-1)/7),n}_handleDateSelection(e){function t(e,t){if(a._clearSelection(!0),e.getTime()<t.value.getTime())for(;e.getTime()<=t.value.getTime();)a._selectDate(e,!0),e.setDate(e.getDate()+1);else if(e.getTime()>t.value.getTime())for(;e.getTime()>=t.value.getTime();)a._selectDate(e,!0),e.setDate(e.getDate()-1);else a._selectDate(t,!0);a.$.hiddenInput.value=a.selectedDates.toString(),a._setFooter(),a.$.fireEvent("change",{value:a.selectedDates}),a._setTitle()}const a=this;if(!("undefined"==typeof e||e.disabled||e.restricted)){let n=a._selectedDates;switch(a.selectionMode){case"none":a._focusDate(e);break;case"one":case"default":if(a._keysPressed.Control)return 1<a.selectedDates.length||1===a.selectedDates.length&&!e.selected?void a._selectDate(e):void a._focusDate(e);if(a._keysPressed.Shift)return void t(new Date(a.selectedDates[0]),e);a._clearSelection(!0),a._selectDate(e,!!(-1<n.indexOf(e)));break;case"many":{if(0===a.selectedDates.length)return void a._selectDate(e);const n=a.selectedDates[a.selectedDates.length-1];let i=new Date(a.selectedDates[0]);if(e.value.getTime()===i.getTime()||e.value.getTime()===n.getTime())return a._clearSelection(),void a._focusDate(e);0<a.selectedDates.length&&t(i,e);break}case"zeroOrMany":a._selectDate(e);break;case"oneOrMany":if(1===a.selectedDates.length&&e.selected)return void a._focusDate(e);a._selectDate(e);break;case"zeroOrOne":if(1===a.selectedDates.length&&e.selected)return void a._selectDate(e);a._clearSelection(!0),a._selectDate(e);break;case"week":{if(e.selected&&(e.value.getTime()===a.selectedDates[0].getTime()||e.value.getTime()===a.selectedDates[a.selectedDates.length-1].getTime()))return a._clearSelection(),void a._focusDate(e);a._clearSelection(!0);let t=new Date(e.value);a._selectDate(t);for(let e=1;8>e;e++)t.setDate(t.getDate()+1,7>e),a._selectDate(t);a._isDateInView(t)||a.navigate(1);break}}}}_handleImportantDateTemplate(){const e=this;if(e._importantDatesTemplate=e._validateTemplate("importantDatesTemplate",e.importantDatesTemplate),!e._importantDatesTemplate||!e._importantDatesTemplate.content)return;let t=e._importantDatesTemplate.content;const a=t.childNodes.length,n=/{{\w+}}/g;let s;e._bindingDetails=[];for(let o=0;o<a;o++)if(s=n.exec(t.childNodes[o].innerHTML),s)return void e._bindingDetails.push({childNodeIndex:o,bindingString:s[0]})}_handleLayoutTemplate(e,t){const a=this,n=a._validateTemplate(e.$.hasClass("smart-header")?"headerTemplate":e.$.hasClass("smart-footer")?"footerTemplate":"titleTemplate",t);if(!n||!n.content)return void("function"==typeof t&&t(e,{}));a._layoutTemplates||(a._layoutTemplates=[]);let s=document.importNode(n.content,!0);e.innerHTML="";const o=s.childNodes.length,l=/{{\w+}}/g;let r,d=[];for(let a=0;a<o;a++)r=l.exec(s.childNodes[a].innerHTML),r&&d.push({childNodeIndex:a,bindingString:r[0]});a._layoutTemplates=a._layoutTemplates.filter(t=>t.selector!==e),a._layoutTemplates.push({selector:e,template:n,bindings:d}),e.appendChild(s)}_handleItemHoveredState(e,t){const a=this;if(!a._animationStarted){if("month"===a.displayMode)if("mouseover"===e.type&&"many"===a.selectionMode&&0<a.selectedDates.length){const e=a.$.monthsContainer.children;for(let t=0;t<e.length;t++)a._getMonthDays(e[t]).days.map(e=>e.classList.remove("hovered"));let n=new Date(a.selectedDates[0]),i=new Date(t.value),s=t;const o=n.getTime()>i.getTime()?-1:1,l=function(){s=a._getDayInstanceByValue(n,a.$.monthsContainer),!s||s.selected||s.restricted||s.classList.add("hovered")};if(n.getTime()!==i.getTime()){for(n.setDate(n.getDate()+o);n.getTime()!==i.getTime();)l(),n.setDate(n.getDate()+o);l()}}else t.classList.remove("hovered");"mouseover"!==e.type||t.classList.contains("smart-other-month-date")?t.classList.remove("hovered"):t.classList.add("hovered")}}_handleMonths(e,t){function a(e){let t,a=e.children.length,n=document.createDocumentFragment();for(a;a<s.months;a++)t=s.$.month.cloneNode(!1),t.innerHTML=s.$.month.innerHTML,n.appendChild(t);return n}function n(t){let a=t.children;for(let n=0;n<a.length;n++)s._setMonth(e,a[n]),e.setMonth(e.getMonth()+1);s._setWeeksVisibility(t),s._updateHeaderElements(),s._setHeader(),s.tooltip&&s.$.tooltip.close(),s.$.content===document.activeElement&&s._focusDate()}const s=this;let i;if(e||(e=s._dateInView&&0<s._dateInView.length?s._dateInView[0]:new Date),e=new Date(Math.min(Math.max(s.min.getTime(),e.getTime()),s.max.getTime())),t||(t=s.$.monthsContainer),s._selectedDates=[],s.$.hasClass("animation")){for(i=s.$.nextMonthsContainer.children,0<i.length&&i[0].value instanceof Date&&(s.$.nextMonthsContainer.innerHTML="");s.$.nextMonthsContainer.childElementCount<s.months;)s.$.nextMonthsContainer.appendChild(a(s.$.nextMonthsContainer));for(;s.$.nextMonthsContainer.childElementCount>s.months;)s.$.nextMonthsContainer.removeChild(i[s.$.nextMonthsContainer.childElementCount-1]);if(arguments[1]===s.$.nextMonthsContainer)return void n(s.$.nextMonthsContainer)}if(i=s.$.monthsContainer.children,i.length>s.months){for(;s.$.monthsContainer.childElementCount>s.months;)s.$.monthsContainer.removeChild(i[s.$.monthsContainer.childElementCount-1]),s._dateInView.pop();return void n(s.$.monthsContainer)}return s.$.monthsContainer.children.length===s.months?void n(s.$.monthsContainer):void(s._dateInView=[],s.$.monthsContainer.appendChild(a(s.$.monthsContainer)),n(s.$.monthsContainer))}_headerChangeHandler(e){const t=this;return e.stopPropagation(),t.disabled||t.readonly?void 0:e.target.ownerElement===t.$.monthElement&&0!==t._changeEventFired?void t._changeEventFired--:void(e.target===t.$.yearElement&&(t._dateInView[0].setFullYear(Math.min(Math.max(t.min.getFullYear(),isNaN(parseInt(t.$.yearElement.value))?0:parseInt(t.$.yearElement.value)),t.max.getFullYear())),t._handleMonths(t._dateInView[0])),t.$.monthElement&&e.target.ownerElement===t.$.monthElement&&t._handleMonths(new Date(t.$.monthsContainer.children[0]._date.getFullYear(),t.$.monthElement.selectedIndexes[0],1)))}_headerClickHandler(e){const t=this;if(!(t.disabled||t.readonly)){let a=e.target.closest("smart-repeat-button");if(!(a&&a.disabled))return a===t.$.previousMonthButton?void t.navigate(-1*t.months):a===t.$.nextMonthButton?void t.navigate(1*t.months):a===t.$.decrementYearButton?void t.navigate(-12):a===t.$.incrementYearButton?void t.navigate(12):"classic"===t.calendarMode?void(t.displayMode="month"):void(e.target.closest(".smart-date-element")&&(t._animationStarted&&t._animateNavigationCompleted(),t._showDateView()))}}_setDisplayMode(e,t,a){const n=this;if(0===arguments.length||!n.$.hasClass("animation"))return"classic"===n.calendarMode?void(n.displayMode="month"):("month"!==n.displayMode&&(n.$monthsContainer.addClass("smart-hidden"),n.$dateViewContainer.hasClass("smart-hidden")&&n.$dateViewContainer.removeClass("smart-hidden")),!n.isCompleted&&"month"===n.displayMode)?void 0:void n._setDisplayModeContent();if(n._animationStarted&&(n.displayMode=e,n._animateNavigationCompleted(),n.displayMode=t),"month"===e&&"year"===t||"year"===e&&"decade"===t)n.displayMode=e,n._showDateView(a?void 0:n.displayMode);else if("month"===e&&"decade"===t)n._showDateView(n.displayMode="year");else{let e;"list"===n.displayModeView?(e=n.$.listViewContainer.querySelectorAll("smart-list-item[selected]")[0],n.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(0<e.dataItem.top?e.offsetTop-e.offsetHeight/2:e.offsetTop+e.offsetHeight/2)+"px"):(e=n._focusedDate,n.$.animationPanel.style.transformOrigin=e.offsetLeft+e.offsetWidth/2+"px "+(e.offsetTop+e.offsetHeight/2)+"px"),n._animateView(1,e)}}_setDisplayModeContent(e,t){const a=this;let n=e&&"Invalid Date"!==e.toString()?e:0<a.selectedDates.length?a.selectedDates[a.selectedDates.length-1]:new Date;n.setTime(Math.min(Math.max(n.getTime(),a.min.getTime()),a.max.getTime())),n.setHours(0,0,0,0);const s=a._prepareView(n);if(!s)return;let i;t?(a.$.nextMonthsContainer.innerHTML=a.$.dateViewContainer.innerHTML,i=a.$.nextMonthsContainer):i=a.$.dateViewContainer;const o=i.children;let l;for(let r=0;r<o.length;r++)o[r].innerHTML=s.viewContent[r],o[r].value=s.dates[r],"year"===a.displayMode?(o[r].value.getFullYear()<a.min.getFullYear()||o[r].value.getFullYear()===a.min.getFullYear()&&o[r].value.getMonth()<a.min.getMonth()||o[r].value.getFullYear()>a.max.getFullYear()||o[r].value.getFullYear()===a.max.getFullYear()&&o[r].value.getMonth()>a.max.getMonth()?o[r].classList.add("smart-other-month-date"):o[r].classList.remove("smart-other-month-date"),n.getFullYear()===o[r].value.getFullYear()&&n.getMonth()===o[r].value.getMonth()&&(l=o[r])):"decade"===a.displayMode&&(0==r||r==o.length-1||o[r].value.getFullYear()<a.min.getFullYear()||o[r].value.getFullYear()>a.max.getFullYear()?o[r].classList.add("smart-other-month-date"):o[r].classList.remove("smart-other-month-date"),n.getFullYear()===o[r].value.getFullYear()&&(l=o[r])),o[r].classList.remove("hovered");if(l.classList.contains("smart-other-month-date"))for(let e=0;e<o.length;e++)if(!o[e].classList.contains("smart-other-month-date")){l=o[e];break}a._focusedDate&&(a._focusedDate.focused=!1,a._focusedDate.removeAttribute("focused")),l.focused=!0,l.setAttribute("focused",""),a._focusedDate=l,a._setHeader(),a._updateHeaderElements(),a.$.fireEvent("displayModeChange"),setTimeout(function(){a.$.content.focus()},0)}_prepareView(e){function t(e,t,a){let n=new Date(e,t+1,0),i=n.getDate();return a>i?n.setDate(i):n.setDate(a),n}const a=this;let n,i,s=[],o=[];if("month"===a.displayMode)return a.$nextMonthsContainer.hasClass("smart-date-view-container")&&a.$nextMonthsContainer.removeClass("smart-date-view-container"),a.$listViewContainer.addClass("smart-hidden"),a.$dateViewContainer.hasClass("smart-visibility-hidden")&&a.$dateViewContainer.removeClass("smart-visibility-hidden"),a._isDateInView(e)||a._handleMonths(e),a.$header.hasClass("smart-hidden")&&a.$header.removeClass("smart-hidden"),a.$content.hasClass("smart-calendar-list-view")&&a.$content.removeClass("smart-calendar-list-view"),a.$dateContainer.addClass("smart-selected"),a.$yearContainer.removeClass("smart-selected"),a.$dateViewContainer.addClass("smart-hidden"),a.$monthsContainer.removeClass("smart-hidden"),a._setHeader(),a.$.content.setAttribute("tabindex",0<a.tabIndex?a.tabIndex:0),a._updateHeaderElements(),a.$.content.focus(),a._focusDate(a._getDayInstanceByValue(e)),void a.$.fireEvent("displayModeChange");if("list"===a.displayModeView)return a._setDisplayModeListContent(e),void a.$.fireEvent("displayModeChange");if(a.$header.hasClass("smart-hidden")&&a.$header.removeClass("smart-hidden"),a.$dateViewContainer.hasClass("smart-visibility-hidden")&&a.$dateViewContainer.removeClass("smart-visibility-hidden"),a.$listViewContainer.addClass("smart-hidden"),a.$.content.setAttribute("tabindex",0<a.tabIndex?a.tabIndex:0),"year"===a.displayMode){let n=new Date;for(let l=0;12>l;l++)n=t(n.getFullYear(),l,n.getDate()),s.push(n.toLocaleDateString(a.locale,{month:"short"})),o.push(t(e.getFullYear(),l,e.getDate()))}else{n=e?e.getFullYear():a._dateInView[0].getFullYear(),i=n%10,0!==i&&(n-=i),n-=1;for(let t=0;12>t;t++)s.push(n+""),o.push(new Date(n,e.getMonth(),e.getDate())),++n}return{viewContent:s,dates:o}}_setDisplayModeListContent(e){function t(e,t,a){let n=new Date(e,t+1,0),i=n.getDate();return a>i?n.setDate(i):n.setDate(a),n}const a=this;let n=[];if(a.$dateViewContainer.addClass("smart-visibility-hidden"),a.$listViewContainer.hasClass("smart-hidden")&&(a.$content.addClass("smart-calendar-list-view"),a.$listViewContainer.removeClass("smart-hidden"),a.$.listViewContainer._setFocusable(),a.$.content.removeAttribute("tabindex")),a.$header.addClass("smart-hidden"),"year"===a.displayMode){let s=new Date;for(let o=0;12>o;o++)s=t(s.getFullYear(),o,s.getDate()),n.push({label:s.toLocaleDateString(a.locale,{month:"short"}),value:t(e.getFullYear(),o,e.getDate()).toDateString()});a.$yearContainer.removeClass("smart-selected"),a.$dateContainer.addClass("smart-selected")}else{let t=a.min.getFullYear(),s=a.max.getFullYear();for(let a=t;a<=s;a++)n.push({label:a.toString(),value:new Date(a,e.getMonth(),e.getDate()).toDateString()});a.$yearContainer.addClass("smart-selected"),a.$dateContainer.removeClass("smart-selected")}a.$.listViewContainer.dataSource=n,a.$.listViewContainer.selectedValues=[e.toDateString()],a.$.listViewContainer.ensureVisible(a.$.listViewContainer.selectedValues[0]),a._setHeader(),a._updateHeaderElements()}_isDateInView(e){const t=this;if(e)for(let a=0;a<t._dateInView.length;a++)if(e.getFullYear()===t._dateInView[a].getFullYear()&&e.getMonth()===t._dateInView[a].getMonth()){let a=t._getDayInstanceByValue(e,t._animationStarted?t.$.nextMonthsContainer:t.$.monthsContainer);return a?!(a.classList.contains("smart-other-month-date")||a.classList.contains("smart-visibility-hidden")):void 0}}_keyDownHandler(e){const t=this;if(!(t.disabled||t.readonly))switch(document.activeElement){case t.$.yearElement:"Escape"===e.key&&t._updateHeaderElements();break;case t.$.dateElement:if("default"===t.calendarMode&&" "===e.key||"Enter"===e.key)return void t._showDateView();t._focusedDate||t._focusDate(),t._navigateDays(e);break;case t.$.content:t._navigateDays(e);break;case t.$.yearContainer:if((" "===e.key||"Enter"===e.key)&&"decade"!==t.displayMode&&(e.preventDefault(),t._showDateView("year")),-1<e.key.indexOf("Arrow")){if(e.preventDefault(),t._focusedDate||t._focusDate(),"month"!==t.displayMode&&"list"===t.displayModeView)return t.focus(),void t.$.listViewContainer._handleKeyStrokes(e.key);t._navigateDays(e)}break;case t.$.dateContainer:if((" "===e.key||"Enter"===e.key)&&"month"!==t.displayMode&&(e.preventDefault(),t._displayModeHandler("list"===t.displayModeView?t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]):t._focusedDate,"month")),-1<e.key.indexOf("Arrow")){if(t._focusedDate||t._focusDate(),"month"!==t.displayMode&&"list"===t.displayModeView)return t.focus(),void t.$.listViewContainer._handleKeyStrokes(e.key);t._navigateDays(e)}break;default:if("month"!==t.displayMode&&"list"===t.displayModeView)return(["Arrow","End","Home","Page"].indexOf(e.key)&&e.preventDefault()," "===e.key||"Enter"===e.key||e.ctrlKey&&("ArrowUp"===e.key||"ArrowDown"===e.key))?void t._navigateDays(e):void t.$.listViewContainer._handleKeyStrokes(e.key);-1<e.key.indexOf("Arrow")&&(!t._focusedDate&&t._focusDate(),t._navigateDays(e));}}_listViewContainerChangeEventHandler(e){e.stopPropagation()}_listViewContainerKeyDownHandler(e){const t=this;"list"!==t.displayModeView||(" "===e.key||"Enter"===e.key)&&t._navigateDays(e)}_showDateView(e){const t=this;if(e=e?e:t.displayMode,"month"===e?e="year":"year"===e?e="decade":void 0,t.displayMode===e)return;const a=t.$.fireEvent("displayModeChanging",{oldDisplayMode:t.displayMode,newDisplayMode:e}).defaultPrevented;if(a)return;t.displayMode=e;let n;return arguments[0]&&"list"===t.displayModeView&&"month"!==t.displayMode&&0<t.$.listViewContainer.items.length?(n=t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]),t.$.animationPanel.style.transformOrigin=n.offsetHeight?n.offsetLeft+n.offsetWidth/2+"px "+(0<n.dataItem.top?n.offsetTop-n.offsetHeight/2:n.offsetTop+n.offsetHeight/2)+"px":t.$.listViewContainer.offsetLeft+t.$.listViewContainer.offsetWidth/2+"px "+(0<n.dataItem.top?n.offsetTop-n.offsetHeight/2:t.$.listViewContainer.offsetTop+t.$.listViewContainer.offsetHeight/2)+"px"):(!t._focusedDate&&t._focusDate(),n=t._focusedDate,t.$.animationPanel.style.transformOrigin=n.offsetLeft+n.offsetWidth/2+"px "+(n.offsetTop+n.offsetHeight/2)+"px"),t.$monthsContainer.addClass("smart-hidden"),t.$dateViewContainer.hasClass("smart-hidden")&&t.$dateViewContainer.removeClass("smart-hidden"),"decade"===t.displayMode&&(t.$yearContainer.addClass("smart-selected"),t.$dateContainer.removeClass("smart-selected")),t.$.hasClass("animation")?void t._animateView(-1,n):void t._setDisplayModeContent(t._focusedDate?t._focusedDate.value:t._dateInView[0])}_keyUpHandler(e){const t=this;t.disabled||t.readonly||"default"===t.selectionMode&&("Shift"===e.key||"Control"===e.key)&&(t._keysPressed[e.key]=!1)}_mouseEventsHandler(e){const t=this;if(t.disabled||t.readonly)return;if("mouseenter"===e.type)return void t.$.addClass("hovered");if("mouseleave"===e.type)return t.$.removeClass("hovered"),void(t.tooltip&&t.$.tooltip.close());if(!e.target.closest(".smart-calendar-week"))return void(t.tooltip&&t.$.tooltip.close());let a,n=e.target;for(;n&&!(n.value instanceof Date);)n=n.parentElement,a=!0;if(n&&(Smart.Utilities.Core.isMobile||t._handleItemHoveredState(e,n),t.tooltip)){if(n.hasAttribute("important")&&"mouseover"===e.type)return t.$.tooltip.open(),t.tooltipTemplate?t.$.tooltip.value=n.value+"":t.$.tooltip.innerHTML=0===t.$.tooltip.innerHTML.trim().length?"Important day!":t.$.tooltip.innerHTML,t.$.tooltip.selector=n,void(t.$.tooltip.selector!==n&&t.$.tooltip.close());if(a||t.$.tooltip.selector===n)return;t.$.tooltip.close()}}_moveHandler(e){var t=Math.round;const a=this;if(!Smart.Utilities.Core.isMobile||!a._dragStartDetails||"list"===a.displayModeView&&"month"!==a.displayMode)return;e.originalEvent.preventDefault(),e.preventDefault(),e.stopPropagation();const n={x:t(e.pageX),y:t(e.pageY)};let i="portrait"===a.scrollButtonsNavigationMode?n.y>a._dragStartDetails.y?-1*a.months:1*a.months:n.x<a._dragStartDetails.x?1*a.months:-1*a.months;const s=a._getNextDate(i);if(!s)return;if(a._dragStartDetails.step=i,a._dragStartDetails.navigationDate=new Date(s),!a.$.hasClass("animation"))return;let o;if("month"!==a.displayMode)a.$nextMonthsContainer.addClass("smart-date-view-container"),o=a.$.dateViewContainer,a.$.nextMonthsContainer.children[0].value instanceof Date&&a.$.nextMonthsContainer.children[1].value.getFullYear()===s.getFullYear()||a._setDisplayModeContent(s,a.$.nextMonthsContainer);else if(a.$nextMonthsContainer.hasClass("smart-date-view-container")&&a.$nextMonthsContainer.removeClass("smart-date-view-container"),o=a.$.monthsContainer,!a.$.nextMonthsContainer.children[0]._date||a.$.nextMonthsContainer.children[0]._date.getTime()!==s.getTime()){let e=a.$.nextMonthsContainer.children;for(let t=0;t<e.length;t++)s.setMonth(a._dragStartDetails.navigationDate.getMonth()+t),a._setMonth(s,e[t],!0)}0>i?(o.style.order=3,a.$.nextMonthsContainer.style.order=1,a.$.content[a._animationSettings.scrollSize]=a.$.content[a._animationSettings.scrollMax]):(o.style.order=1,a.$.nextMonthsContainer.style.order=3,a.$.content[a._animationSettings.scrollSize]=0);const l="portrait"===a.scrollButtonsNavigationMode?"y":"x";10<Math.abs(a._dragStartDetails[l]-n[l])&&(a.$.content[a._animationSettings.scrollSize]+=2*-(n[l]-a._dragStartDetails[l]))}_getNextDate(e){const t=this;let a;if("month"!==t.displayMode){let n;if("list"===t.displayModeView)a=new Date(t.$.listViewContainer.items[0].value);else{let e=t._animationStarted?t.$.nextMonthsContainer:t.$.dateViewContainer;a=new Date("year"===t.displayMode?e.children[0].value:e.children[1].value)}if(n="year"===t.displayMode?1:0<e?10:1,a.setFullYear(a.getFullYear()+(0<e?n:-n)),"year"===t.displayMode){if(a.getFullYear()<t.min.getFullYear()||a.getFullYear()>t.max.getFullYear())return;}else if(a.getFullYear()<t.min.getFullYear()||a.getFullYear()>t.max.getFullYear())return}else{let n=t._dateInView[0];if(a=new Date(n),a.setDate(1),a.setMonth(a.getMonth()+e),a.setTime(Math.min(Math.max(a.getTime(),t.min.getTime()),t.max.getTime())),n.getMonth()===a.getMonth()&&n.getFullYear()===a.getFullYear())return}return a}_navigateDays(e){const t=this;let a="ArrowUp"===e.key||"ArrowDown"===e.key?7:1,n="ArrowUp"===e.key||"ArrowLeft"===e.key||"PageUp"===e.key?-1:1;switch(e.key){case"ArrowUp":case"ArrowLeft":case"ArrowDown":case"ArrowRight":if(!t._handleArrowKeys(e,a,n))return;break;case" ":case"Enter":if("month"!==t.displayMode)return void t._displayModeHandler("list"===t.displayModeView?t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]):t._focusedDate);break;case"Control":case"Shift":return void("default"===t.selectionMode&&(t._keysPressed[e.key]=!0));case"Home":case"End":{e.preventDefault();let a,n=function(t){if("Home"===e.key){for(let e=0;e<t.length;e++)if(0===t[e].classList.length&&(!t[e].disabled||!t[e].restricted))return t[e];}else for(let e=t.length-1;0<=e;e--)if(0===t[e].classList.length&&(!t[e].disabled||!t[e].restricted))return t[e]};if(a="month"===t.displayMode?n(t._getMonthDays(t._focusedDate.closest(".smart-calendar-month"),t.rightToLeft).days):n(t.$.dateViewContainer.children),!a)return;t._focusDate(a);break}case"PageUp":case"PageDown":{if(!t._handlePageUpDownKeys(e,n))return;break}default:return;}t._focusedDate&&t._handleDateSelection(t._focusedDate)}_handleArrowKeys(e,t,a){const n=this;let i;if("month"!==n.displayMode||n._animationStarted||n.$.content.focus(),!e.altKey){if(e.ctrlKey){if("ArrowDown"===e.key||"ArrowUp"===e.key){let t;switch(n.displayMode){case"month":t="ArrowDown"===e.key?"month":"year";break;case"year":t="ArrowDown"===e.key?"month":"decade";break;case"decade":t="ArrowDown"===e.key?"year":"decade";}if(t!==n.displayMode){const e=n.displayMode;n.displayMode=t,n._setDisplayMode(e,t,"month"===e),n._keysPressed&&delete n._keysPressed.Control}}return}if(e.preventDefault(),n.rightToLeft&&("ArrowLeft"===e.key||"ArrowRight"===e.key)&&(a*=-1),"month"!==n.displayMode){let s=n._animationStarted?n.$.nextMonthsContainer.children:n.$.dateViewContainer.children;if(t="ArrowUp"===e.key||"ArrowDown"===e.key?4:1,"year"===n.displayMode){const e=n._focusedDate.value.getMonth()+a*t;let s=new Date(n._focusedDate.value.getFullYear(),e+1,0);n._focusedDate.value.getDate()<=s.getDate()&&(s=n._focusedDate.value),i=new Date(n._focusedDate.value.getFullYear(),e,s.getDate())}else i=new Date(n._focusedDate.value.getFullYear()+a*t,n._focusedDate.value.getMonth(),n._focusedDate.value.getDate());if("year"===n.displayMode){if(i.getFullYear()<n.min.getFullYear()||i.getFullYear()===n.min.getFullYear()&&i.getMonth()<n.min.getMonth()||i.getFullYear()>n.max.getFullYear()||i.getFullYear()===n.max.getFullYear()&&i.getMonth()>n.max.getMonth())return;i.getTime()>s[s.length-1].value.getTime()?n.navigate(1):i.getTime()<s[0].value.getTime()&&n.navigate(-1)}else{if(i.getFullYear()<n.min.getFullYear()||i.getFullYear()>n.max.getFullYear())return;if(i.getFullYear()<s[1].value.getFullYear()||i.getFullYear()>s[10].value.getFullYear()){let t=n._focusedDate;n.navigate(a),("ArrowUp"===e.key||"ArrowDown"===e.key)&&(t===s[3]||t===s[4]||t===s[7]||t===s[8]?i.setFullYear(i.getFullYear()+2*a):i.setFullYear(i.getFullYear()-2*a))}}return void n._focusDate(n._getDayInstanceByValue(i,n._animationStarted?n.$.nextMonthsContainer:void 0))}let s=n.restrictedDates.map(Number);for(i=new Date(n._focusedDate.value.getFullYear(),n._focusedDate.value.getMonth(),n._focusedDate.value.getDate()+a*t,0,0,0,0);-1<s.indexOf(i.getTime());)i.setDate(i.getDate()+a);if(!(i.getTime()<n.min.getTime()||i.getTime()>n.max.getTime())){n._isDateInView(i)||n.navigate(a*n.months);let e=n._getDayInstanceByValue(i,n._animationStarted?n.$.nextMonthsContainer:void 0);return n._focusDate(e),!(-1<["zeroOrMany","oneOrMany","none","many","week"].indexOf(n.selectionMode))||void 0}}}_handlePageUpDownKeys(e,t){const a=this;e.preventDefault();let n;if("month"!==a.displayMode){if(n=a._focusedDate,!a.navigate(t))return;for(;n&&n.classList.contains("smart-visibility-hidden");)n=null===n.previousElementSibling?n.nextElementSibling:n.previousElementSibling;return a._focusDate(n),void(a.$.hasClass("animation")&&"decade"===a.displayMode&&a._focusedDate.value.setFullYear(a._focusedDate.value.getFullYear()+10*t))}n=new Date(a._focusedDate.value.getFullYear(),a._focusedDate.value.getMonth()+t,1,0,0,0,0);let i=new Date(n.getFullYear(),n.getMonth()+1,0).getDate();return a._focusedDate.value.getDate()>i?n.setDate(i):n.setDate(a._focusedDate.value.getDate()),a._isDateInView(n)||a.navigate(t*a.months),a._animationStarted?a._focusDate(a._getDayInstanceByValue(n,a.$.nextMonthsContainer)):a._focusDate(a._getDayInstanceByValue(n)),!0}_selectDate(e,t,a){const n=this;if("undefined"==typeof n._dateInView||"none"===n.selectionMode)return;let i=n.selectedDates.slice(0);if(e instanceof HTMLElement&&e.parentElement.classList.contains("smart-calendar-week"))e=n._selectDay(e);else if(e instanceof Date){let t=n._getDayInstanceByValue(e,n._animationStarted?n.$.nextMonthsContainer:n.$.monthsContainer);t&&n._selectDay(t)}else return;let s;e=new Date(e),e.setHours(0,0,0,0),s=i.map(Number).indexOf(e.getTime());-1<n.restrictedDates.map(Number).indexOf(e.getTime())||e.getTime()<n.min.getTime()||e.getTime()>n.max.getTime()||(-1<s?i.splice(s,1):i.push(e),!a&&(n.selectedDates=i),!t&&(n._setFooter(),n.$.hiddenInput.value=n.selectedDates.toString(),n.$.fireEvent("change",{value:[e]})),n._setTitle())}_selectDay(e){const t=this;let a=e;if(!(!a||-1<t.restrictedDates.map(Number).indexOf(a.value.getTime())||t.disableAutoNavigation&&0<a.classList.length||a.value.getTime()<t.min.getTime()||a.value.getTime()>t.max.getTime())){let e=t._selectedDates.indexOf(a);return-1<e?(a.selected=!1,a.removeAttribute("selected"),t._selectedDates.splice(e,1)):(a.selected=!0,a.setAttribute("selected",""),t._selectedDates.push(a)),t._focusDate(a),a.value}}_setDayNames(){function e(e){let a;return a="firstTwoLetters"===t.dayNameFormat?new Intl.DateTimeFormat(t.locale,{weekday:"long"}).format(e).substr(0,2):new Intl.DateTimeFormat(t.locale,{weekday:t.dayNameFormat}).format(e),a}const t=this;let a,n=[],s=new Date;for(let t=1;8>t;t++)s.setDate(t),a={number:s.getDay(),name:e(s)},n.push(a);n.sort((e,t)=>e.number>t.number);const i=t.$.monthsContainer.children;let o,l;for(let e=0;e<i.length;e++)if(o=i[e].getElementsByClassName("smart-calendar-week-titles")[0].children,l=6<t.firstDayOfWeek?0:t.firstDayOfWeek,t.rightToLeft)for(let e=o.length-1;0<=e;e--)o[e].textContent=n[l++].name,l=6<l?0:l;else for(let e=1;e<o.length;e++)o[e].textContent=n[l++].name,l=6<l?0:l}_setCalendarMode(){const e=this;if(!e.headerTemplate)if(e._setMonthNames(),"default"===e.calendarMode){e.$classicHeaderDate.addClass("smart-hidden"),e.$defaultHeaderDate.removeClass("smart-hidden");const t=e._dateInView.slice(0).sort((e,t)=>e.getTime()-t.getTime());let a=t[0].toLocaleDateString(e.locale,{year:e.yearFormat,month:e.monthNameFormat});1<e.months&&(a+=" - "+t[t.length-1].toLocaleDateString(e.locale,{year:e.yearFormat,month:e.monthNameFormat})),e.$.defaultHeaderDate.innerHTML=a,e.unfocusable||e.$.dateElement.setAttribute("tabindex",0<e.tabIndex?e.tabIndex:0)}else e.$defaultHeaderDate.addClass("smart-hidden"),e.$classicHeaderDate.removeClass("smart-hidden"),e.$.dateElement.removeAttribute("tabindex")}_setFooter(){function e(){if(0===t.selectedDates.length)return"";if(1===t.selectedDates.length)return t.selectedDates[0].toLocaleDateString(t.locale,{year:t.yearFormat,weekday:"short",month:"short",day:"numeric"});else{let e=t.selectedDates.slice(0).sort((e,t)=>e.getTime()-t.getTime());return e[0].toLocaleDateString(t.locale,{year:t.yearFormat,weekday:"short",month:"short",day:"numeric"})+" - "+e[e.length-1].toLocaleDateString(t.locale,{year:t.yearFormat,weekday:"short",month:"short",day:"numeric"})}}const t=this;if(!("many"!==t.selectionMode||0>t.viewSections.indexOf("footer")||0===t.$.footer.offsetHeight)){if(t.footerTemplate){if("function"==typeof t.footerTemplate)return;let a=t._layoutTemplates.filter(e=>e.selector===t.$.footer)[0],n=document.importNode(a.template.content,!0);if(0<a.bindings.length){let t=n.childNodes[a.bindings[0].childNodeIndex];a.selector.childNodes[a.bindings[0].childNodeIndex].innerHTML=t.innerHTML.replace(a.bindings[0].bindingString,e())}return}t.$.selectedDatesRange.innerHTML=e()}}_setImportantDates(e){function t(e){if(!a._importantDatesTemplate)return"function"==typeof a.importantDatesTemplate?void a.importantDatesTemplate(e,{value:e.value}):void(e.innerHTML=e.value.getDate()+"");let t=document.importNode(a._importantDatesTemplate.content,!0);if(a._bindingDetails&&0<a._bindingDetails.length){let n=t.childNodes[a._bindingDetails[0].childNodeIndex];n.innerHTML=n.innerHTML.replace(a._bindingDetails[0].bindingString,e.value.getDate())}e.innerHTML="";for(let a=0;a<t.childNodes.length;a++)t.childNodes[a].outerHTML&&(e.innerHTML+=t.childNodes[a].outerHTML)}const a=this;let n;if("month"===a.displayMode){if(!e){n=a.$.monthsContainer.children;for(let e=0;e<n.length;e++)a._getMonthDays(n[e]).days.map(e=>{e.important=!1,e.removeAttribute("important")})}if(e&&e.value instanceof Date)return e.important=!0,e.setAttribute("important",""),void t(e);if(e=a.importantDates,e instanceof Array){let n,i=e.length;for(let s=0;s<i;s++)n=a._getDayInstanceByValue(e[s]),n&&(n.important=!0,n.setAttribute("important",""),t(n))}}}_setMonth(e,t,a){const n=this,i=n._getDays(e,n.selectedDates),s=n._getDays(e,n.importantDates),o=n._getDays(e,n.restrictedDates);e.setDate(1),t||(t=n.$.month),t._date=new Date(e),a||((!n._dateInView||n._dateInView.length>=n.months)&&(n._dateInView=[]),n._dateInView.push(new Date(e))),e=new Date(e);let l=(e.getDay()-n.firstDayOfWeek+7)%7;e.setDate(0);let r=e.getDate();if(e.setDate(32),e.setDate(1),e.setDate(32),n._selectedDates)for(let e=0;e<n._selectedDates.length;e++)n._selectedDates[e].closest(".smart-calendar-month")===t&&(n._selectedDates[e].selected=!1,n._selectedDates[e].removeAttribute("selected"));n._setMonthContent(e,t,{previusMonthDays:r,firstDayOfWeek:l,selectedDates:i,importantDates:s,restrictedDates:o})}_setMonthContent(e,t,a){const n=this,i=32-e.getDate(),s=n._getMonthDays(t,n.rightToLeft),o=t._date.getMonth(),l=t._date.getFullYear(),r=new Date;let m,c=1,h=1,g=s.days;r.setHours(0,0,0,0),g.map(e=>{e.disabled=e.restricted=e.selected=e.focused=e.important=e.today=!1,e.removeAttribute("restricted"),e.removeAttribute("selected"),e.removeAttribute("focused"),e.removeAttribute("important"),e.removeAttribute("today")});for(let s=0;s<g.length;s++)g[s].classList.remove("hover"),s===a.firstDayOfWeek&&h<=i?(g[s].hasAttribute("class")&&g[s].removeAttribute("class"),g[s].value=new Date(l,o,h),g[s].innerHTML=g[s].value.getDate().toString(),-1<a.restrictedDates.indexOf(h)||g[s].value.getTime()<n.min.getTime()||g[s].value.getTime()>n.max.getTime()?(g[s].restricted=!0,g[s].setAttribute("restricted","")):-1<a.selectedDates.indexOf(h)&&(g[s].selected=!0,g[s].setAttribute("selected",""),0>n._selectedDates.indexOf(g[s])&&n._selectedDates.push(g[s])),-1<a.importantDates.indexOf(h)&&(n._setImportantDates(g[s]),a.importantDates.splice(a.importantDates.indexOf(h),1)),g[s].value.getTime()===r.getTime()&&(g[s].today=!0,g[s].setAttribute("today","")),a.firstDayOfWeek++,h++):(1==h?(g[s].value=new Date(l,o-1,++a.previusMonthDays-a.firstDayOfWeek),m=!!(g[s].value.getTime()<n.min.getTime()||t.previousElementSibling)):(g[s].value=new Date(l,o+1,c++),m=!!(g[s].value.getTime()>n.max.getTime()||t.nextElementSibling)),g[s].innerHTML=g[s].value.getDate().toString(),m?g[s].classList.add("smart-visibility-hidden"):(g[s].classList.add("smart-other-month-date"),g[s].classList.remove("smart-visibility-hidden")));1<n.months&&(t.firstElementChild.innerHTML=n.dateFormatFunction?n.dateFormatFunction(t._date):n._monthsNames[o]+" "+t._date.toLocaleDateString(n.locale,{year:n.yearFormat})),n._setMonthWeekNumbers(t,s.weeks)}_setMonthNames(){function e(e){let a=new Intl.DateTimeFormat(t.locale,{month:t.monthNameFormat}).format(e);return"firstTwoLetters"===t.monthNameFormat&&(a=a.substr(0,2)),a}const t=this;let a,n=new Date;n.setDate(1),t._monthsNames=[];for(let i=0;12>i;i++)n.setMonth(i),a=e(n),t._monthsNames.push(a);if("classic"===t.calendarMode&&t.$.monthElement){let e=t.$.monthsContainer.children;if(t.$.monthElement.dataSource&&(t._changeEventFired=1),t.$.monthElement.dataSource=t._monthsNames,t._dateInView){for(let a=0;a<e.length;a++)e[a].firstElementChild.textContent=t._monthsNames[e[a]._date.getMonth()]+" "+e[a]._date.getFullYear();t._changeEventFired=1,t.$.monthElement.selectedIndexes=t._dateInView.map(e=>e.getMonth())}}}_setMonthWeekNumbers(e,t){const a=this,n=function(e){for(let t=1;t<e.children.length;t++)if(!e.children[t].classList.contains("smart-visibility-hidden"))return!0};let i,s;for(let o=0;o<t.length;o++){if(!n(t[o])){t[o].children[0].innerHTML="";continue}i=t[o].children[1],s=i.classList.contains("smart-other-month-date")?i.value.getTime()>e._date.getTime()?1:-1:0,t[o].children[0].innerHTML=a._getWeekNumber(new Date(e._date.getFullYear(),e._date.getMonth()+s,i.value.getDate()))}}_setRestrictedDates(e){const t=this,a=e.length;let n=t.$.monthsContainer.children;for(let a=0;a<n.length;a++)t._getMonthDays(n[a]).days.map(e=>{e.restricted=!1,e.removeAttribute("restricted")});if(t._dateInView){let n,s=function(e){for(let a=0;a<t._dateInView.length;a++)if(t._dateInView[a].getFullYear()===e.getFullYear()&&t._dateInView[a].getMonth()===e.getMonth())return!0};for(let o=0;o<a;o++)s(e[o])&&(n=t._getDayInstanceByValue(e[o]),n.restricted=!0,n.setAttribute("restricted",""))}}_setScrollButtonsNavigationMode(){const e=this;"landscape"===e.scrollButtonsNavigationMode?(e.$.previousMonthButton&&(e.$.previousMonthButton.$.button.firstElementChild.innerHTML="&#xe809"),e.$.nextMonthButton&&(e.$.nextMonthButton.$.button.firstElementChild.innerHTML="&#xe810")):(e.$.previousMonthButton&&(e.$.previousMonthButton.$.button.firstElementChild.innerHTML="&#xe80b"),e.$.nextMonthButton&&(e.$.nextMonthButton.$.button.firstElementChild.innerHTML="&#xe80d")),e._applyAnimationSettings(!0)}_setTitle(){const e=this;if(0===e.$.title.offsetHeight)return;let t=0<e.selectedDates.length?e.selectedDates[e.selectedDates.length-1]:new Date;if(e.titleTemplate){if("function"==typeof e.titleTemplate)return;let a=e._layoutTemplates.filter(t=>t.selector===e.$.title)[0],n=document.importNode(a.template.content,!0);if(0<a.bindings.length){let i=n.childNodes[a.bindings[0].childNodeIndex];return t=t.toLocaleDateString(e.locale,{year:e.yearFormat,weekday:"short",month:"short",day:"numeric"}),void(a.selector.childNodes[a.bindings[0].childNodeIndex].innerHTML=i.innerHTML.replace(a.bindings[0].bindingString,t))}}e.$.title.children[0].innerHTML=t.toLocaleDateString(e.locale,{year:e.yearFormat}),e.$.title.children[1].innerHTML="landscape"===e.view?t.toLocaleDateString(e.locale,{weekday:"short"})+",</br>"+t.toLocaleDateString(e.locale,{month:"short",day:"numeric"}):t.toLocaleDateString(e.locale,{weekday:"short"})+", "+t.toLocaleDateString(e.locale,{month:"short",day:"numeric"})}_setWeeksVisibility(e){function t(e){return function(e){for(let t=1;t<e.children.length;t++)if(!e.children[t].classList.contains("smart-visibility-hidden"))return!1;return!0}(e)||i>=a.weeks?void e.classList.add("smart-hidden"):void(i<a.weeks&&(e.classList.remove("smart-hidden"),i++))}const a=this,n=e.children;let i;for(let s=0;s<n.length;s++){let e=a._getMonthDays(n[s]).weeks,o=a._selectedDates.filter(e=>e.closest(".smart-calendar-month")===n[s]);if(6===a.weeks){e.map(e=>e.classList.remove("smart-hidden"));continue}if(i=0,0<o.length){let a=o[o.length-1],n=e.indexOf(a.parentElement);for(let a=n;a<e.length;a++)t(e[a]);for(let a=n-1;0<=a;a--)t(e[a])}else for(let a=0;a<e.length;a++)t(e[a])}}_updateHeaderElements(){const e=this,t=e._animationStarted?e.$.nextMonthsContainer:e.$.dateViewContainer;let a,n,i=e._dateInView[e._dateInView.length-1],s=e._dateInView.map(e=>e.getFullYear());if("month"===e.displayMode||"list"!==e.displayModeView){if(e.$.previousMonthButton&&!e.disabled&&("month"!==e.displayMode&&e.$.dateViewContainer.children[0].value?n="year"===e.displayMode?t.children[0].value.getFullYear()-1:t.children[1].value.getFullYear()-1:0>e._dateInView[0].getMonth()-1?(a=11,n=e._dateInView[0].getFullYear()-1):(a=e._dateInView[0].getMonth()-1,n=e._dateInView[0].getFullYear()),e.$.previousMonthButton.disabled=!!(n<e.min.getFullYear()||n===e.min.getFullYear()&&a<e.min.getMonth()),e.$.previousMonthButton.disabled&&e.$.content.focus()),e.$.nextMonthButton&&!e.disabled&&("month"!==e.displayMode&&e.$.dateViewContainer.children[0].value?n="year"===e.displayMode?t.children[0].value.getFullYear()+1:t.children[1].value.getFullYear()+11:11<i.getMonth()+1?(a=0,n=i.getFullYear()+1):(a=i.getMonth()+1,n=i.getFullYear()),e.$.nextMonthButton.disabled=!!(n>e.max.getFullYear()||n===e.max.getFullYear()&&a>e.max.getMonth()),e.$.nextMonthButton.disabled&&e.$.content.focus()),"classic"===e.calendarMode&&e.$.monthElement){const t=e.$.monthElement.items;if(t.map(e=>e.disabled=!1),-1<s.indexOf(e.min.getFullYear()))for(let a=0;a<e.min.getMonth();a++)t[a].disabled=!0;if(-1<s.indexOf(e.max.getFullYear()))for(let a=e.max.getMonth()+1;a<t.length;a++)t[a].disabled=!0;e._changeEventFired=e.$.monthElement.selectedIndexes.length,e.$.monthElement.selectedIndexes=[e._dateInView[0].getMonth()],e._changeEventFired=0}e.$.decrementYearButton&&!e.disabled&&(n=e._dateInView[0].getFullYear()-1,e.$.decrementYearButton.disabled=!!(n<e.min.getFullYear()),e.$.decrementYearButton.disabled&&e.$.content.focus()),e.$.incrementYearButton&&!e.disabled&&(n=i.getFullYear()+1,e.$.incrementYearButton.disabled=!!(n>e.max.getFullYear()),e.$.incrementYearButton.disabled&&e.$.content.focus()),e.$.yearElement&&(e.$.yearElement.value=s[0],e.$.yearElement.disabled=!!(i.getFullYear()+1>e.max.getFullYear()&&e._dateInView[0].getFullYear()-1<e.min.getFullYear()))}}_setHeader(){function e(){if("month"!==t.displayMode){if("list"===t.displayModeView&&t.$.listViewContainer.selectedValues[0])a="year"===t.displayMode?new Date(t.$.listViewContainer.getItem(t.$.listViewContainer.selectedValues[0]).value).getFullYear():t.min.getFullYear()+" - "+t.max.getFullYear();else if(t.$.dateViewContainer.children[0].value){let e=t._animationStarted?t.$.nextMonthsContainer.children:t.$.dateViewContainer.children;a="year"===t.displayMode?e[0].value.getFullYear():e[1].value.getFullYear()+" - "+e[e.length-2].value.getFullYear()}if(a)return a}const e=t._dateInView.slice(0).sort((e,t)=>e.getTime()-t.getTime());return a=e[0].toLocaleDateString(t.locale,{year:t.yearFormat,month:t.monthNameFormat}),1<t.months&&(a+=" - "+e[e.length-1].toLocaleDateString(t.locale,{year:t.yearFormat,month:t.monthNameFormat})),a}const t=this;let a;if("default"===t.calendarMode&&(t.$.defaultHeaderDate.innerHTML=e()),"function"!=typeof t.headerTemplate&&t._layoutTemplates){let a=t._layoutTemplates.filter(e=>e.selector===t.$.header)[0];if(a){let n=document.importNode(a.template.content,!0);if(0<a.bindings.length){const i=n.childNodes[a.bindings[0].childNodeIndex];a.selector.childNodes[a.bindings[0].childNodeIndex].innerHTML=i.innerHTML.replace(a.bindings[0].bindingString,t.dateFormatFunction?t.dateFormatFunction(t._dateInView):e())}}}}_updateWeeksVisibility(e){const t=this,a=e.parentElement;if(!a.classList.contains("smart-hidden"))return;const n=[].slice.call(a.parentElement.children),s=n.indexOf(a),o=function(e){for(let t=1;t<e.children.length;t++)if(!e.children[t].classList.contains("smart-visibility-hidden"))return!1;return!0};let l=0;n.map(e=>e.classList.add("smart-hidden"));for(let a=s;a<n.length;a++)if(!o(n[a])&&(n[a].classList.remove("smart-hidden"),l++,l===t.weeks))return;if(l<t.weeks)for(let e=s-1;0<=e;--e)if(n[e].classList.remove("smart-hidden"),l++,l===t.weeks)return}_validateDate(e){function t(e){if(e instanceof Date)return e;if(Smart.Utilities.DateTime&&e instanceof Smart.Utilities.DateTime)return e.toDate();if("string"==typeof e){if("new Date()"===e.trim()||"new Smart.Utilities.DateTime()"===e.trim())return new Date;if(isNaN(Date.parse(e))){let t=/(\d+[,-.\/]{1}\s*\d+[,-.\/]{1}\s*\d+)/;t.test(e)&&(e=t.exec(e)[0].replace(/[,-.\/]/g,",").split(","),e&&(e=new Date(parseInt(e[0]),parseInt(e[1]),parseInt(e[2]))))}return new Date(Date.parse(e))}}let a=[];if(void 0!==e){if(e instanceof Array)for(let n=0;n<e.length;n++)a.push(t(e[n]));else a.push(t(e));return a=a.filter(e=>e&&"Invalid Date"!==e.toDateString()),a.map(e=>e.setHours(0,0,0,0)),a}}_validateSelectedDates(e){const t=this;let a=[];e||(e=t.selectedDates);let n=e.slice(0),i=function(e){for(let a=0;a<t.restrictedDates.length;a++)if(t.restrictedDates[a].getTime()===e.getTime())return!0};t.selectedDates=n.filter(function(e){return!!(e.getTime()>=t.min.getTime()&&e.getTime()<=t.max.getTime()&&!i(e))||void a.push(e)}),t._dateInView&&(a.map(e=>t._selectDate(e)),t._focusDate())}_validateMinMax(e,t,a){const n=this;switch(e){case"min":t=n._validateDate(n[e])[0],n.min=t?t:a?a:n.properties.min.defaultValue;break;case"max":t=n._validateDate(n[e])[0],n.max=t?t:a?a:n.properties.max.defaultValue;break;default:t=n._validateDate(n.min)[0],n.min=t?t:a?a:n.properties.min.defaultValue,t=n._validateDate(n.max)[0],n.max=t?t:a?a:n.properties.max.defaultValue;}n.min=n.min.getTime()>n.max.getTime()?n.max:n.min,n.min.setHours(0,0,0,0),n.max.setHours(0,0,0,0);let s,o=n.$.monthsContainer.children;if(n._dateInView){if(n._dateInView[0].getTime()>n.max.getTime()||n._dateInView[0].getTime()<n.min.getTime())return void n._handleMonths();for(let e=0;e<o.length;e++){s=n._getMonthDays(o[e]).days;for(let t=0;t<s.length;t++)if(s[t].value.getTime()>=n.min.getTime()&&s[t].value.getTime()<=n.max.getTime())s[t].restricted=!1,s[t].removeAttribute("restricted"),s[t].value.getMonth()===o[e]._date.getMonth()?s[t].classList.remove("smart-visibility-hidden"):!n.hideOtherMonthDays&&(s[t].classList.add("smart-other-month-date"),s[t].classList.remove("smart-visibility-hidden")),"month"!==n.displayMode&&s[t].classList.remove("smart-other-month-date");else{if(0===s[t].classList.length)s[t].restricted=!0,s[t].setAttribute("restricted","");else if(s[t].classList.contains("smart-visibility-hidden")){s[t].restricted=!1,s[t].removeAttribute("restricted");continue}"month"!==n.displayMode&&(s[t].classList.remove("smart-visibility-hidden"),s[t].classList.add("smart-other-month-date"))}}}}_validateTemplate(e,t){if(null!==t&&t&&"function"!=typeof t){const a=this;return"content"in document.createElement("template")?("string"==typeof t&&(t=document.getElementById(t)),null!==t&&"content"in t?t:void a.error(a.localize("invalidTemplate",{elementType:a.nodeName.toLowerCase(),property:e}))):void a.error(a.localize("htmlTemplateNotSuported",{elementType:a.nodeName.toLowerCase()}))}}_weeksDownHandler(e){const t=this,a=e.value;let n;return(e.classList.contains("smart-other-month-date")&&(n=e.value.getTime()>e.closest(".smart-calendar-month")._date.getTime()?1:-1),n)?t._isDateInView(e.value)?void 0:void(t.disableAutoNavigation||t.navigate(n*t.months)):void(e=t._getDayInstanceByValue(a),e&&(e.disabled||e.restricted)||t._handleDateSelection(e))}_firstDayOfWeekValidator(e,t){return Math.min(Math.max(0,isNaN(t)?6:t),6)}_weeksValidator(e,t){return Math.min(Math.max(1,isNaN(t)?6:t),6)}_monthsValidator(e,t){return Math.min(Math.max(1,isNaN(t)?1:t),12)}});