
/* Smart HTML Elements v1.1.0 (2018-June) 
Copyright (c) 2011-2018 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-combo-box",class extends Smart.DropDownList{static get properties(){return{autoComplete:{allowedValues:["none","manual","auto","inline"],type:"string",value:"none"},autoCompleteDelay:{value:700,type:"number"},escKeyMode:{allowedValues:["none","previousValue","clearValue"],type:"string",value:"none"},minLength:{type:"number",value:2},value:{value:"",type:"string"}}}static get listeners(){return{"input.focus":"_inputFocusHandler","input.blur":"_inputFocusHandler","input.change":"_inputChangeEventHandler","input.mouseenter":"_buttonsMouseEventsHandler","input.mouseleave":"_buttonsMouseEventsHandler","document.down":"_documentDownHandler","document.up":"_documentUpHandler","document.selectstart":"_selectStartHandler","dropDownButton.down":"_buttonsDownHandler","dropDownButton.mouseenter":"_buttonsMouseEventsHandler","dropDownButton.mouseleave":"_buttonsMouseEventsHandler",keydown:"_keyDownHandler",keyup:"_keyUpHandler","listBox.change":"_listBoxChangeHandler","listBox.keydown":"_listBoxKeyDownHandler",wheel:"_mouseWheelHandler"}}template(){return`<div id="container">
                    <span class="smart-label" id="label">[[label]]</span>
                    <div id="content" class="smart-content">
                         <div id="selectionField" class ="smart-selection-field">
                             <input id="input" placeholder="[[placeholder]]"/>
                             <div id="autoCompleteString"></div>
                         </div>
                        <span id="dropDownButton" class ="smart-drop-down-button smart-unselectable">
                            <span id="arrow"></span>
                        </span>
                         <div id="dropDownContainer" class="smart-drop-down smart-visibility-hidden">
                            <smart-list-box id="listBox"
                                    unfocusable="true"
                                    data-source="[[dataSource]]"
                                    disabled="[[disabled]]"
                                    display-loading-indicator="[[displayLoadingIndicator]]"
                                    display-member="[[displayMember]]"
                                    filterable="[[filterable]]"
                                    filter-mode="[[filterMode]]"
                                    filter-input-placeholder="[[filterInputPlaceholder]]"
                                    grouped="[[grouped]]"
                                    group-member="[[groupMember]]"
                                    item-height="[[itemHeight]]"
                                    item-template="[[itemTemplate]]"
                                    incremental-search-delay="[[incrementalSearchDelay]]"
                                    incremental-search-mode="[[incrementalSearchMode]]"
                                    loading-indicator-placeholder="[[loadingIndicatorPlaceholder]]"
                                    loading-indicator-position="[[loadingIndicatorPosition]]"
                                    name="[[name]]"
                                    placeholder="[[dropDownPlaceholder]]"
                                    readonly="[[readonly]]"
                                    selected-indexes="{{selectedIndexes}}"
                                    selection-mode="[[selectionMode]]"
                                    selected-values="{{selectedValues}}"
                                    sorted="[[sorted]]"
                                    value-member="[[valueMember]]"
                                    virtualized="[[virtualized]]">
                                <content></content>
                            </smart-list-box>
                            <div id="resizeBar" class="smart-drop-down-resize-bar">
                                <div></div>
                            </div>
                         </div>
                    </div>
                    <span class="smart-hint" id="hint">[[hint]]</span>
                </div>`}propertyChangedHandler(a,b,c){const d=this;switch(a){case"autoComplete":d._autoComplete(!0);break;case"dataSource":case"displayMember":d._clearSelection(!0),d._setDropDownSize(),d._checkBrowserBounds("vertically"),d.dropDownAppendTo&&0<d.dropDownAppendTo.length&&d._rePositionListBox(),d._checkBrowserBounds("horizontally");break;case"disabled":d.$.input.disabled=c,d._setFocusable(),d.close();break;case"readonly":d.$.input.readOnly=c,d.close();break;case"selectedValues":case"selectedIndexes":0===c.length&&d._clearSelection(!0);break;case"selectionMode":case"selectionDisplayMode":if(d._applySelectionDisplayMode(),"tokens"===d.selectionDisplayMode&&(d._currentSelection=void 0),"selectionMode"===a)return;d._applySelection(d.selectionMode);break;case"tokenTemplate":if(d.$.selectionField)for(;"SPAN"===d.$.selectionField.firstElementChild.nodeName;)d.$.selectionField.removeChild(d.$.selectionField.firstElementChild);d._tokenTemplate=d._validateTemplate(d.tokenTemplate),d._applySelection();break;case"value":d._queryItems(!0);break;default:super.propertyChangedHandler(a,b,c);}}clearItems(){const a=this;a.$.listBox.clearItems(),a._clearSelection(!0)}clearSelection(){const a=this;a.$.listBox.clearSelection(),a._clearSelection(!arguments[0])}_setFocusable(){const a=this;if(!a.disabled&&!a.unfocusable){let b=0<a.tabIndex?a.tabIndex:0;return a.$.input.tabIndex=b,void("dropDownButton"===a.dropDownOpenMode?a.$.dropDownButton.setAttribute("tabindex",b):a.$.dropDownButton.removeAttribute("tabindex"))}a.$.input.tabIndex=-1,a.$.dropDownButton.removeAttribute("tabindex")}_autoComplete(a){const b=this,c=b.$.input.value.length<b.minLength?"":"escaped"===b.displayMode?b._toDefaultDisplayMode(b.$.input.value):b.$.input.value,d=function(a){for(let b=0;b<a.length;b++)if(a[b].focused)return!0};let e;1===b.$.listBox.selectedValues.length&&(e=b.$.listBox.getItem(b.$.listBox.selectedValues[0])),b.$.autoCompleteString.textContent="",b.$.listBox.$.filterInput.value="none"===b.autoComplete||b.$.input.value.length<b.minLength?"":c;const f=function(){if(b.$.listBox.isAttached&&b.$.input){if(b._setDropDownSize(),b.opened&&(b.dropDownAppendTo&&0<b.dropDownAppendTo.length&&b._rePositionListBox(),b._checkBrowserBounds()),b.$.listBox._filteredItems&&0<b.$.listBox._filteredItems.length){if(b.$.listBox._scrollView.scrollTop=b.$.listBox._filteredItems[0].offsetTop,"none"!==b.autoComplete&&b.$.input.value.length>=b.minLength&&!d(b.$.listBox._filteredItems)&&b._focus(b.$.listBox._filteredItems[0]),"inline"===b.autoComplete&&b.$.input.value.length>=b.minLength&&(b.$.autoCompleteString.style.width=b.$.input.offsetWidth+"px",b.$.autoCompleteString.style.height=b.$.input.offsetHeight+"px",b.$.autoCompleteString.style.left=b.$.input.offsetLeft+"px",b.$.autoCompleteString.style.top=b.$.input.offsetTop+"px",b.$.listBox._filteredItems[0].label.length!==b.$.input.value.length&&(b.$.autoCompleteString.textContent=b.$.input.value+b.$.listBox._filteredItems[0].label.slice(b.$.input.value.length))),e&&e.label===b.$.listBox._filteredItems[0].label&&e.value===b.$.listBox._filteredItems[0].value&&(b.$.listBox.context=b.$.listBox,b.$.listBox._select(b.$.listBox._filteredItems[0],!0),b.$.listBox.context=g),c!==b.$.listBox._filteredItems[0].label){if(b._closedFromKeyCombination)return void(b._closedFromKeyCombination=!1);if(c.length<b.minLength)return void b.close();b.isCompleted&&"none"!==b.dropDownOpenMode&&b.open()}return}b.close()}};let g=b.$.listBox.context;b.$.listBox.context=b.$.listBox,b.$.listBox._filterItems(!!a,f),b.$.listBox.context=g}_applySelection(a,b){function c(){for(;"SPAN"===d.$.selectionField.firstElementChild.nodeName;)d.$.selectionField.removeChild(d.$.selectionField.firstElementChild);let a,b,c=document.createDocumentFragment();b="tokens"===d.selectionDisplayMode?1===d.selectedIndexes.length&&("oneOrManyExtended"===d.selectionMode||"oneOrMany"===d.selectionMode)?"":"&#10006":",",d.selectedIndexes.map(e=>{a=d._applyTokenTemplate(d.$.listBox._items[e].label,b),a._value=d.$.listBox._items[e].value,c.appendChild(a)}),d.$.selectionField.insertBefore(c,d.$.input),d._currentSelection=d.selectedIndexes.map(a=>d.$.listBox._items[a].label),d.$.container.setAttribute("has-value",""),d._oldValue=d.value=d._currentSelection.toString(),d.opened&&d.dropDownAppendTo&&0<d.dropDownAppendTo.length&&d._rePositionListBox()}const d=this;if(d.$.autoCompleteString.textContent="",0===d.selectedIndexes.length)return void d._clearSelection(b&&d.$.input.value===b.label);if(d.$.listBox._items&&0!==d.$.listBox._items.length)if("one"===d.selectionMode||"zeroOrOne"===d.selectionMode||"radioButton"===d.selectionMode){if(d._currentSelection&&d._currentSelection.length>d.selectedIndexes.length)return d._currentSelection=d.selectedIndexes.map(a=>d.$.listBox._items[a].label),d.$.input.value=d._currentSelection.toString(),void(d._oldValue=d.value=d._currentSelection.toString());d._clearSelection(),d._currentSelection=d.selectedIndexes.map(a=>d.$.listBox._items[a].label),d.$.input.value=d._currentSelection.toString(),d._oldValue=d.value=d._currentSelection.toString(),d.$.container.setAttribute("has-value",""),"none"!==d.autoComplete&&(d._autoComplete(!0),d.close())}else{if(d.$.input.value="",d.$.input.placeholder="",d.$.container.setAttribute("has-value",""),!d._currentSelection||"oneOrManyExtended"===d.selectionMode||"radioButton"===d.selectionMode&&!d.grouped)return void c();const a=d.$.selectionField.getElementsByClassName("smart-token");if(d._currentSelection.length<d.selectedIndexes.length){const a=d.$.listBox._items[d.selectedIndexes[d.selectedIndexes.length-1]];let b,c;c="tokens"===d.selectionDisplayMode?1===d.selectedIndexes.length&&("oneOrManyExtended"===d.selectionMode||"oneOrMany"===d.selectionMode)?"":"&#10006":",",1===d.selectedIndexes.length&&("oneOrManyExtended"===d.selectionMode||"oneOrMany"===d.selectionMode)&&(c=""),b=d._applyTokenTemplate(a.label,c),b._value=a.value,d.$.selectionField.insertBefore(b,d.$.input),"none"!==d.autoComplete&&d.$.listBox._filteredItems&&d.$.listBox._filteredItems.length!==d.$.listBox._items.length&&d._autoComplete(!0),d.opened&&d.dropDownAppendTo&&0<d.dropDownAppendTo.length&&d._rePositionListBox()}else{if(0<d._currentSelection.length&&0===a.length||d._currentSelection.length===d.selectedIndexes.length&&d._currentSelection.toString()!==d.selectedValues.toString())return void c();if(!b)return;for(let c=0;c<a.length;c++)if(a[c]._value===b.value){d.$.selectionField.removeChild(a[c]);break}}d._currentSelection=d.selectedIndexes.map(a=>d.$.listBox._items[a].label),d._oldValue=d.value=d._currentSelection.toString()}}_applySelectionDisplayMode(){const a=this;"one"===a.selectionMode||"zeroOrOne"===a.selectionMode||"radioButton"===a.selectionMode?a.$.removeClass("auto-height"):a.$.addClass("auto-height")}_bindingCompleteHandler(){const a=this,b="one"===a.selectionMode||"oneOrMany"===a.selectionMode||"oneOrManyExtended"===a.selectionMode;a._queryItems(b),a._setDropDownSize()}_buttonsMouseEventsHandler(a){const b=this;b.disabled||b.readonly||("mouseenter"===a.type?(a.target.$.addClass("hovered"),"auto"===b.dropDownOpenMode&&(a.target===b.$.dropDownButton?(b.open(),b.$.input.focus()):b.close())):a.target.$.removeClass("hovered"))}_createElement(){const a=this;a._tokenTemplate=a._validateTemplate(a.tokenTemplate),a._applySelectionDisplayMode(),a._applySelection(a.selectionMode),"none"!==a.autoComplete&&a._autoComplete(!0),a._setDropDownSize(),a.$.input.disabled=a.disabled,a.$.input.readOnly=a.readonly,a._setFocusable(),0<a.$.input.value.length&&0===a.selectedIndexes.length&&(a.$.container.setAttribute("has-value",""),a._oldValue=a.value=a.$.input.value),a.$.arrow.noRipple=!0,a.disabled||"auto"!==a.dropDownPosition||PositionDetection.handleAutoPositioning.call(this,a._scrollHandler,200,()=>"auto"!==a.dropDownPosition)}_clearSelection(a){const b=this;if(a&&(b.$.input.value=""),b.$.input.placeholder=b.placeholder,b.$.autoCompleteString.textContent="",b._currentSelection=[],b.$.selectionField)for(;"SPAN"===b.$.selectionField.firstElementChild.nodeName;)b.$.selectionField.removeChild(b.$.selectionField.firstElementChild);"none"!==b.autoComplete&&0<b.$.input.value.length&&(b._autoCompleteTimer&&clearTimeout(b._autoCompleteTimer),b._autoCompleteTimer=setTimeout(function(){b._autoComplete(!0)},b.autoCompleteDelay)),b.$.container.removeAttribute("has-value")}_documentUpHandler(a){const b=this;let c=a.originalEvent.target;if(b._resizeDetails&&b._resizeDetails.started)return b._resizeDetails.started=b._resizeDetails.resizeEventFired=!1,b.removeAttribute("resizing"),b._dropDownResized=!0,void b.$.fireEvent("resizeEnd",{position:{left:a.pageX,top:a.pageY}});if(!(b.disabled||b._isListBoxThumbDragged||b.readonly||c===b.$.input)&&"undefined"!=typeof c&&c!==b.$.resizeBar){if(c===b.$.selectionField)return void b.$.input.focus();if(c===b.$.dropDownButton&&"none"!==b.dropDownOpenMode)return b.$dropDownContainer.hasClass("smart-visibility-hidden")?b.open():b.close(),void b.$.input.focus();if(c.classList.contains("smart-drop-down-list-selection-label")&&c.closest("smart-combo-box")===b&&"none"!==b.dropDownOpenMode){b.open();let a=b.$.listBox._items.filter(a=>a.label.toString()===c.textContent)[0];return b.$.input.focus(),b.$.listBox._scrollView.scrollTop=a.offsetTop,void b._focus(a)}if(c.classList.contains("smart-drop-down-list-unselect-button")&&c.closest("smart-combo-box")===b)return 1===b.selectedIndexes.length&&0>["zeroOrMany","zeroOrOne","checkBox"].indexOf(b.selectionMode)?void 0:(b.unselect(b.$.listBox._items.filter(a=>a.label.toString()===c.previousElementSibling.textContent)[0]),void b.$.input.focus());for(;c;){if(c instanceof Smart.ListItem&&c.ownerListBox===b.$.listBox){c="item";break}else if(c===b.$.listBox){c="listBox";break}c=c.parentElement}(!b.$dropDownContainer.hasClass("smart-visibility-hidden")&&"listBox"!==c&&"item"!==c||"item"===c&&0>b.selectionMode.indexOf("Many")&&"checkBox"!==b.selectionMode)&&b.close(),("item"===c||"listBox"===c&&a.originalEvent.target!==b.$.listBox.$.filterInput)&&b.$.input.focus()}}_inputFocusHandler(a){const b=this;b.disabled||("focus"===a.type?(b.setAttribute("focused",""),b._oldValue=b.$.input.value):(b.removeAttribute("focused"),""!==a.target.value||0!==b.selectedIndexes.length&&""===a.target.value?b.$.container.setAttribute("has-value",""):b.$.container.removeAttribute("has-value"),!Smart.Utilities.Core.isMobile&&!b._preventDropDownClose&&b.close(),("auto"===b.autoComplete||"inline"===b.autoComplete)&&0<b.$.input.value.length&&b.$.listBox._focusedItem&&b.select(b.$.listBox._focusedItem),"previousValue"===b.escKeyMode&&(b.value=b.$.input.value)))}_inputChangeEventHandler(a){const b=this;a.stopPropagation(),b.$.fireEvent("change",{oldValue:b._oldValue,newValue:b.$.input.value,selectedItems:b.selectedItems,selectedValues:b.selectedValues})}_keyDownHandler(a){const b=this;if(!(b.disabled||b.readonly||a.target===b.$.listBox.$.filterInput))switch(a.key){case"Enter":return void(a.target===b.$.input&&b.$.listBox._focusedItem&&b.opened?(b.select(b.$.listBox._focusedItem),!b.$dropDownContainer.hasClass("smart-visibility-hidden")&&(b.close(),b._unfocus())):a.target===b.$.dropDownButton&&(b.$dropDownButton.addClass("active"),b.$dropDownContainer.hasClass("smart-visibility-hidden")&&"none"!==b.dropDownOpenMode?b.open():b.close(),b.$.input.focus()));case"Escape":switch(b._oldValue!==b.$.input.value||b.$dropDownContainer.hasClass("smart-visibility-hidden")||(b.close(),b._unfocus()),b.escKeyMode){case"none":break;case"clearValue":b.value=b.$.input.value="";break;case"previousValue":b.$.input.value=b._oldValue;}break;case"End":case"Home":case"PageUp":case"PageDown":case"ArrowUp":case"ArrowDown":if(a.altKey){if(b._closedFromKeyCombination=!0,b.$dropDownContainer.hasClass("smart-visibility-hidden")&&"none"!==b.dropDownOpenMode){if(b.open(),0===b.items.length)return;0===b.selectedIndexes.length?b._focus(b.items[0]):0<b.selectedIndexes.length&&!b.$.listBox._items[b.selectedIndexes[b.selectedIndexes.length-1]].hidden&&b._focus(b.items[b.selectedIndexes[b.selectedIndexes.length-1]])}else b.close();return}if(a.target===b.$.input&&b.$dropDownContainer.hasClass("smart-visibility-hidden"))return;if(("PageUp"===a.key||"PageDown"===a.key)&&!b.$.listBox._focusedItem||a.target===b.$.listBox.$.filterInput)return;if(a.preventDefault(),!b.$.listBox._focusedItem||b.$.listBox._focusedItem&&!b.$.listBox._focusedItem.focused)return void b._focus(b.items[0]);b.$.listBox._handleKeyStrokes(a.key);break;case"Backspace":if(b.$.input.previousElementSibling){if(0===b.$.input.value.length){if(1===b.selectedIndexes.length&&0>["zeroOrMany","zeroOrOne","checkBox"].indexOf(b.selectionMode))return;b.unselect(b.$.listBox.getItem(b.$.input.previousElementSibling._value))}return}1<b.selectedIndexes.length&&b.clearSelection(!0);break;default:a.target===b.$.input&&"oneOrManyExtended"===b.selectionMode&&(b.$.listBox._keysPressed[a.key]=!0);}}_keyUpHandler(a){const b=this;if(!(b.disabled||"none"===b.escKeyMode&&"Escape"===a.key||a.target===b.$.listBox.$.filterInput)){if(a.target===b.$.input&&"oneOrManyExtended"===b.selectionMode&&(b.$.listBox._keysPressed[a.key]=!1),-1<["one","radioButton","zeroOrOne"].indexOf(b.selectionMode)&&1===b.selectedIndexes.length&&b.$.input.value!==b._currentSelection[0]&&b.unselect(b.$.listBox._items[b.selectedIndexes[0]]),"Enter"===a.key)return void b.$dropDownButton.removeClass("active");if(a.target===b.$.input&&0>a.key.indexOf("Arrow")&&0>["Control","Shift"].indexOf(a.key)){if(b.value===b.$.input.value)return;if(b.value=b._currentSelection.toString()+(0<b._currentSelection.length?",":"")+b.$.input.value,b.$.autoCompleteString.textContent="",b._closedFromKeyCombination)return void(b._closedFromKeyCombination=!1);if("none"===b.autoComplete?(0<b.$.input.value.length&&b._queryItems(),b.$.listBox._focusedItem&&(b.open()," "!==a.key&&(b.$.listBox._scrollView.scrollTop=b.$.listBox._focusedItem.offsetTop))):(b.$.input.value!==b._currentSelection.toString()||b.$.listBox._filteredItems&&b.$.listBox._filteredItems.length!==b.$.listBox._items.length)&&(b._autoCompleteTimer&&clearTimeout(b._autoCompleteTimer),b._autoCompleteTimer=setTimeout(function(){b._autoComplete()},b.autoCompleteDelay)),b.$.listBox._filteredItems&&b.$.listBox._filteredItems.length===b.$.listBox._items.length)return void b.close()}}}_mouseWheelHandler(a){const b=this;b.disabled||b.readonly||0===b.items.length||!b.$dropDownContainer.hasClass("smart-visibility-hidden")||b.$.listBox._handleKeyStrokes(0<a.deltaY?"ArrowDown":"ArrowUp")}_queryItems(a){const b=this;if(!b.value)return void b.close();let c=b.$.listBox._queryItems(b.$.input.previousElementSibling?b.$.input.value:b.value,b.incrementalSearchMode);0===c.length&&b._unfocus();for(let d=0;d<c.length;d++)if(!c[d].hidden){a&&!c[d].selected&&b.select(c[d]),b._focus(c[d]);break}}_selectStartHandler(a){const b=this;b._resizeDetails&&b._resizeDetails.started&&a.preventDefault()}_unfocus(){const a=this;a.$.listBox._focusedItem&&(a.$.listBox._focusedItem.focused=!1,a.$.listBox._focusedItem=void 0)}});