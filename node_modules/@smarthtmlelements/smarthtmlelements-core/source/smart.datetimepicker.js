
/* Smart HTML Elements v1.1.0 (2018-June) 
Copyright (c) 2011-2018 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-date-time-picker",class extends Smart.BaseElement{static get properties(){return{animationSettings:{value:null,type:"object"},calendarButton:{value:!1,type:"boolean"},calendarButtonPosition:{value:"right",allowedValues:["left","right"],type:"string"},calendarMode:{value:"default",allowedValues:["default","classic"],type:"string"},dayNameFormat:{value:"firstTwoLetters",allowedValues:["narrow","firstTwoLetters","long","short"],type:"string"},disableAutoNavigation:{value:!1,type:"boolean"},displayKind:{value:"unspecified",allowedValues:["UTC","local","unspecified"],type:"string"},displayModeView:{value:"table",allowedValues:["table","list"],type:"string"},dropDownDisplayMode:{value:"default",allowedValues:["default","classic","calendar","timePicker"],type:"string"},dropDownPosition:{value:"bottom",allowedValues:["bottom","overlay-top","overlay-center","overlay-bottom","top","center-bottom","center-top"],type:"string"},editMode:{value:"default",allowedValues:["default","full","partial"],type:"string"},enableMouseWheelAction:{value:!1,type:"boolean"},firstDayOfWeek:{value:0,type:"number"},footerTemplate:{value:null,type:"any"},formatString:{value:"dd-MMM-yy HH:mm:ss.fff",type:"string"},headerTemplate:{value:null,type:"any"},hideDayNames:{value:!1,type:"boolean"},hideOtherMonthDays:{value:!1,type:"boolean"},hideTooltipArrow:{value:!1,type:"boolean"},hint:{value:"",type:"string"},importantDates:{value:[],type:"array"},importantDatesTemplate:{value:null,type:"any"},interval:{value:new Smart.Utilities.TimeSpan(0,0,1),type:"any"},label:{value:"",type:"string"},max:{value:new Smart.Utilities.DateTime(3001,1,1),type:"any"},messages:{value:{en:{now:"Now",dateTabLabel:"DATE",timeTabLabel:"TIME"}},type:"object",extend:!0},min:{value:new Smart.Utilities.DateTime(1600,1,1),type:"any"},name:{value:"",type:"string"},nullable:{value:!1,type:"boolean"},opened:{value:!1,type:"boolean"},placeholder:{value:"Enter date",type:"string"},restrictedDates:{value:[],type:"array"},spinButtons:{value:!1,type:"boolean"},spinButtonsDelay:{value:75,type:"number"},spinButtonsInitialDelay:{value:0,type:"number"},spinButtonsPosition:{value:"right",allowedValues:["left","right"],type:"string"},tooltip:{value:!1,type:"boolean"},tooltipDelay:{value:100,type:"number"},tooltipPosition:{value:"top",allowedValues:["bottom","top","left","right","absolute"],type:"string"},tooltipTemplate:{value:null,type:"any"},value:{defaultReflectToAttribute:!0,value:new Smart.Utilities.DateTime,type:"any"},weekNumbers:{value:!1,type:"boolean"},weeks:{value:6,type:"number"}}}static get listeners(){return{mouseout:"_mouseoutHandler",mouseover:"_mouseoverHandler","calendarButton.click":"_calendarButtonClickHandler","calendarDropDown.change":"_calendarDropDownChangeHandler","downButton.click":"_spinButtonsClickHandler","input.blur":"_inputBlurHandler","input.change":"_inputChangeHandler","input.dragstart":"_inputDragstartHandler","input.focus":"_inputFocusHandler","input.keydown":"_inputKeydownHandler","input.down":"_inputMousedownHandler","input.paste":"_inputPasteHandler","input.select":"_inputSelectHandler","input.wheel":"_inputWheelHandler","dropDown.keydown":"_dropDownKeydownHandler","dropDown.transitionend":"_dropDownTransitionendHandler","dropDownHeader.click":"_dropDownHeaderClickHandler","upButton.click":"_spinButtonsClickHandler","document.up":"_documentUpHandler"}}static get requires(){return{"Smart.Utilities.DateTime":"smart.date.js","Smart.RepeatButton":"smart.button.js","Smart.Calendar":"smart.calendar.js","Smart.TimePicker":"smart.timepicker.js"}}template(){return`<div id="container">
                    <span id="label" class="smart-label">[[label]]</span>
                    <div id="content" class="smart-content">
                        <input id="input" class="smart-date-time-input" type="text" readonly="[[readonly]]" disabled="[[disabled]]" placeholder="[[placeholder]]" name="[[name]]">
                        <div id="spinButtonsContainer" class="smart-spin-buttons-container">
                            <smart-repeat-button initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" readonly="[[readonly]]" unfocusable id="upButton" class="smart-spin-button">
                                <div class="smart-arrow smart-arrow-up"></div>
                            </smart-repeat-button>
                            <smart-repeat-button initial-delay="[[spinButtonsInitialDelay]]" delay="[[spinButtonsDelay]]" readonly="[[readonly]]" unfocusable id="downButton" class="smart-spin-button">
                                <div class="smart-arrow smart-arrow-down"></div>
                            </smart-repeat-button>
                        </div>
                        <div id="calendarButton" class="smart-calendar-button"></div>
                        <div id="dropDown" class="smart-date-time-drop-down smart-visibility-hidden">
                            <div id="dropDownHeader" class="smart-drop-down-header smart-hidden">
                                <div id="selectDate" class="smart-selected"></div>
                                <div id="selectTime"></div>
                            </div>
                            <div id="dropDownContent" class="smart-drop-down-content">
                                <smart-calendar id="calendarDropDown" class="smart-hidden"
                                                animation-settings="[[animationSettings]]"
                                                calendar-mode="[[calendarMode]]"
                                                day-name-format="[[dayNameFormat]]"
                                                disable-auto-navigation="[[disableAutoNavigation]]"
                                                display-mode-view="[[displayModeView]]"
                                                first-day-of-week="[[firstDayOfWeek]]"
                                                header-template="[[headerTemplate]]"
                                                hide-day-names="[[hideDayNames]]"
                                                hide-other-month-days="[[hideOtherMonthDays]]"
                                                hide-tooltip-arrow="[[hideTooltipArrow]]"
                                                important-dates="[[importantDates]]"
                                                important-dates-template="[[importantDatesTemplate]]"
                                                locale="[[locale]]"
                                                selection-mode="one"
                                                spin-buttons-delay="[[spinButtonsDelay]]"
                                                spin-buttons-initial-delay="[[spinButtonsInitialDelay]]"
                                                theme="[[theme]]"
                                                tooltip="[[tooltip]]"
                                                tooltip-delay="[[tooltipDelay]]"
                                                tooltip-position="[[tooltipPosition]]"
                                                tooltip-template="[[tooltipTemplate]]"
                                                unfocusable="[[unfocusable]]"
                                                view-sections='["header", "footer"]'
                                                week-numbers="[[weekNumbers]]"
                                                weeks="[[weeks]]"></smart-calendar>
                            </div>
                        </div>
                    </div>
                    <span id="hint" class="smart-hint">[[hint]]</span>
                </div>`}attached(){const e=this;super.attached();e.isCompleted&&(e._defaultFooterTemplateApplied&&e._addCalendarFooterListeners(),e.$.timePickerDropDown&&e._addTimePickerListener())}detached(){const e=this;if(super.detached(),e._defaultFooterTemplateApplied){const t=e.$.calendarDropDown.$footer;t.unlisten("change"),t.unlisten("click"),t.unlisten("wheel")}e.$.timePickerDropDown&&e.$.timePickerDropDown.$.unlisten("change")}ready(){super.ready();const e=this;e._edge=Smart.Utilities.Core.Browser.Edge,e._edge&&e.$dropDown.addClass("not-in-view"),e._defaultFooterTemplate=document.createElement("template"),e._defaultFooterTemplate.innerHTML=`<div class="smart-date-time-picker-footer">
                <div class="smart-footer-component smart-footer-component-hour">
                    <input type="text" class="smart-hour-element" />
                    <span class="smart-year-elements">
                        <smart-repeat-button class="smart-increment-year-button" initial-delay="0" delay="75">
                            <span class="smart-arrow">&#xe801</span>
                        </smart-repeat-button>
                        <smart-repeat-button class="smart-decrement-year-button" initial-delay="0" delay="75">
                            <span class="smart-arrow">&#xe804</span>
                        </smart-repeat-button>
                    </span>
                </div>
                <div class="smart-footer-component smart-footer-component-minute">
                    <input class="smart-minute-element" />
                    <span class="smart-year-elements">
                        <smart-repeat-button class="smart-increment-year-button" initial-delay="0" delay="75">
                            <span class="smart-arrow">&#xe801</span>
                        </smart-repeat-button>
                        <smart-repeat-button class="smart-decrement-year-button" initial-delay="0" delay="75">
                            <span class="smart-arrow">&#xe804</span>
                        </smart-repeat-button>
                    </span>
                </div>
                <div class="smart-footer-component smart-footer-component-ampm">
                    <input type="text" class="smart-am-pm-element" />
                </div>
                <div class="smart-footer-component smart-footer-component-today">
                    <div class="smart-today-element" title="Now">&#xe812;</div>
                </div>
            </div>`,e._codeToMethod={y:"addYears",yy:"addYears",yyyy:"addYears",yyyyy:"addYears",M:"addMonths",MM:"addMonths",MMM:"addMonths",MMMM:"addMonths",d:"addDays",dd:"addDays",ddd:"addDays",dddd:"addDays",H:"addHours",HH:"addHours",h:"addHours",hh:"addHours",m:"addMinutes",mm:"addMinutes",s:"addSeconds",ss:"addSeconds",f:"addDeciseconds",ff:"addCentiseconds",fff:"addMilliseconds",u:"addMicroseconds",uu:"addMicroseconds",n:"addNanoseconds",nn:"addNanoseconds",p:"addPicoseconds",pp:"addPicoseconds",e:"addFemtoseconds",ee:"addFemtoseconds",a:"addAttoseconds",aa:"addAttoseconds",x:"addZeptoseconds",xx:"addZeptoseconds",o:"addYoctoseconds",oo:"addYoctoseconds"},e._codeToIndex={y:0,yy:0,yyyy:0,yyyyy:0,M:1,MM:1,MMM:1,MMMM:1,d:2,dd:2,ddd:2,dddd:2,H:3,HH:3,h:3,hh:3,m:4,mm:4,s:5,ss:5,f:6,ff:6,fff:6,u:7,uu:7,n:8,nn:8,p:9,pp:9,e:10,ee:10,a:11,aa:11,x:12,xx:12,o:13,oo:13},e._getLocalizedNames(),e._validateInitialPropertyValues(),e._setFocusable()}close(){const e=this;e.opened&&e._close()}focus(){this.$.input.focus()}open(){const e=this;e.opened||e._open()}propertyChangedHandler(e,t,a){function n(e,t,a,n){l.$dropDownHeader[e]("smart-hidden"),l.$calendarDropDown[t]("smart-hidden"),l._timePickerInitialized&&l.$.timePickerDropDown.$[a]("smart-hidden"),n&&(l.opened?l.$.calendarDropDown._setTitle():l._toSync=!0)}super.propertyChangedHandler(e,t,a);const l=this;switch(e){case"calendarButton":l.$.dropDown.style.transition="none",a||l.close();break;case"calendarButtonPosition":l.$.dropDown.style.transition="none",l.close(),"left"===a?l.$.content.insertBefore(l.$.calendarButton,l.$.content.firstElementChild):l.$.content.insertBefore(l.$.calendarButton,l.$.dropDown);break;case"disabled":a?(l.close(),l.$.upButton.disabled=!0,l.$.downButton.disabled=!0):l._disableSpinButtons(),l._setFocusable();break;case"displayKind":{const e=l._outputTimeZone;if("unspecified"===a?l._outputTimeZone=l._inputTimeZone:"UTC"===a?l._outputTimeZone="UTC":"local"===a?l._outputTimeZone="Local":void 0,l._outputTimeZone===e)return;null!==l._value&&(l.close(),l._toSync=!0,l._value=l._value.toTimeZone(l._outputTimeZone),l._applyFormatString()),l.min=l.min.toTimeZone(l._outputTimeZone),l.max=l.max.toTimeZone(l._outputTimeZone);for(let e,t=0;t<l.restrictedDates.length;t++)e=l.restrictedDates[t],e=e.toTimeZone(l._outputTimeZone);break}case"dropDownPosition":l.$.dropDown.style.transition="none",l.close();break;case"readonly":case"unfocusable":a&&l.close(),"unfocusable"===e&&l._setFocusable();break;case"dropDownDisplayMode":"default"===a?(l.$.calendarDropDown.viewSections=["title","header"],l.$selectDate.addClass("smart-selected"),l.$selectTime.removeClass("smart-selected"),n("removeClass","removeClass","addClass",!0)):"classic"===a?(l.$.calendarDropDown.viewSections=["header","footer"],n("addClass","removeClass","addClass")):"calendar"===a?(l.$.calendarDropDown.viewSections=["title","header"],n("addClass","removeClass","addClass",!0)):(n("addClass","addClass","removeClass"),!l._timePickerInitialized&&l._initializeTimePicker());break;case"footerTemplate":if(null!==a){l._defaultFooterTemplateApplied=!1;const e=l.$.calendarDropDown.$footer;e.unlisten("change"),e.unlisten("click"),e.unlisten("wheel"),l.$.calendarDropDown.footerTemplate=a}else{l._setDefaultFooterTemplate();const e=l._value;l._hourElement.value=e.toString("hh"),l._minuteElement.value=e.toString("mm"),l._ampmElement.value=e.toString("tt")}break;case"formatString":""===a&&(l.formatString="dd-MMM-yy HH:mm:ss.fff"),l._getFormatStringRegExp(),l._applyFormatString();break;case"interval":l._validateInterval(t);break;case"locale":case"messages":if(l.$.selectDate.innerHTML=l.localize("dateTabLabel"),l.$.selectTime.innerHTML=l.localize("timeTabLabel"),l._defaultFooterTemplateApplied&&(l._todayElement.title=l.localize("now")),"messages"===e)return;l._getLocalizedNames(),l.min.calendar.days=l._localizedDays,l.min.calendar.months=l._localizedMonths,l.min.calendar.locale=l.locale,l.max.calendar.days=l._localizedDays,l.max.calendar.months=l._localizedMonths,l.max.calendar.locale=l.locale,l._value.calendar.days=l._localizedDays,l._value.calendar.months=l._localizedMonths,l._value.calendar.locale=l.locale,l.value.calendar.days=l._localizedDays,l.value.calendar.months=l._localizedMonths,l.value.calendar.locale=l.locale,Smart.Utilities.DateTime.cache=[],l._applyFormatString();break;case"max":case"min":l._validateMinMax(e,t),l._validateValue();break;case"nullable":!0===t&&null===l._value&&l._validateValue(l._now(),null);break;case"opened":a?l._open():l._close();break;case"restrictedDates":l._validateRestrictedDates(),l._validateValue();break;case"spinButtonsPosition":"right"===a?l.$.content.insertBefore(l.$.spinButtonsContainer,l.$.input.nextElementSibling):l.$.content.insertBefore(l.$.spinButtonsContainer,l.$.input);break;case"theme":l.$.timePickerDropDown&&(l.$.timePickerDropDown.theme=a);break;case"value":{let e;null===a?e=null:(e=Smart.Utilities.DateTime.validateDate(a,l._now(),l.formatString),e=e.toTimeZone(l._outputTimeZone)),l._validateValue(e,l._value);break}}}_addCalendarFooterListeners(){const e=this,t=e.$.calendarDropDown.$footer;t.listen("change",e._footerChangeHandler.bind(e)),t.listen("click",e._footerClickHandler.bind(e)),t.listen("wheel",e._footerWheelHandler.bind(e))}_addTimePickerListener(){const e=this;e.$.timePickerDropDown.$.listen("change",function(t){const a=e.context,n=t.detail.value,i=Smart.Utilities.DateTime.getConstructorParameters(null===e._value?e._now():e._value);e.context=e,i[3]=n.getHours(),i[4]=n.getMinutes(),e._timePickerInitiatedChange=!0,i.unshift(null),e._validateValue(new(Function.prototype.bind.apply(Smart.Utilities.DateTime,i))),e._timePickerInitiatedChange=!1,e.context=a})}_applyFormatString(){const e=this;e.$.input.value=e._value.toString(e.formatString)}_calendarButtonClickHandler(e){const t=this;t._highlightedTimePart=void 0;t.disabled||t.readonly||(-1!==t.theme.indexOf("material")&&Smart.Utilities.Animation.Ripple.animate(t.$.calendarButton,e.pageX,e.pageY),t.opened?t._close():t._open())}_calendarDropDownChangeHandler(e){const t=this;if(e.stopPropagation(),t._disregardCalendarChangeEvent)return void(t._disregardCalendarChangeEvent=!1);if(0<this.$.calendarDropDown.selectedDates.length){const a=e.detail.value[0],n=null===t._value?t._now():t._value,i=Smart.Utilities.DateTime.getConstructorParameters(n);if(i[0]=a.getFullYear(),i[1]=a.getMonth()+1,i[2]=a.getDate(),t._calendarInitiatedChange=!0,i.unshift(null),t._validateValue(new(Function.prototype.bind.apply(Smart.Utilities.DateTime,i))),t._defaultFooterTemplateApplied){const e=t._value;""===t._hourElement.value&&(t._hourElement.value=e.toString("hh")),""===t._ampmElement.value&&(t._ampmElement.value=e.toString("tt")),""===t._minuteElement.value&&(t._minuteElement.value=e.toString("mm"))}t._calendarInitiatedChange=!1}else t._setNullValue()}_cloneValue(){const e=this;return null===e._value?null:e._value.clone()}_close(){const e=this,t=e.$.fireEvent("closing");t.defaultPrevented?e.opened=!0:(e.$.calendarDropDown.disabled=!0,e.$calendarButton.removeClass("smart-calendar-button-pressed"),e.$dropDown.addClass("smart-visibility-hidden"),e.opened=!1,e.$.fireEvent("close"),e._edge&&!e.$.hasClass("animation")&&e.$dropDown.addClass("not-in-view"))}_disableSpinButtons(){const e=this;if(!e.disabled){const t=null===e._value;e.$.upButton.disabled=t,e.$.downButton.disabled=t}}_documentUpHandler(e){const t=this;document.activeElement===t.$.input&&"partial"===t.editMode&&null!==t._value&&(e.originalEvent.target!==t.$.input||t.$.input.selectionStart===t.$.input.selectionEnd)?t._highlightTimePartBasedOnIndex(t._highlightedTimePart.index):e.originalEvent.target!==t.$.calendarButton&&!t.$.dropDown.contains(e.originalEvent.target)&&(t.close(),!t.contains(e.originalEvent.target)&&(t._highlightedTimePart=void 0)),t._mouseFocus=!1}_dropDownHeaderClickHandler(e){const t=this;if(e.target===t.$.selectDate){if(t.$selectDate.hasClass("smart-selected"))return;t.$selectDate.addClass("smart-selected"),t.$selectTime.removeClass("smart-selected"),t.$.timePickerDropDown.$.addClass("smart-hidden"),t.$calendarDropDown.removeClass("smart-hidden")}else{if(t.$selectTime.hasClass("smart-selected"))return;t.$selectDate.removeClass("smart-selected"),t.$selectTime.addClass("smart-selected"),t.$calendarDropDown.addClass("smart-hidden"),t._timePickerInitialized?t.$.timePickerDropDown.$.removeClass("smart-hidden"):t._initializeTimePicker()}}_dropDownKeydownHandler(e){const t=this,a=e.key;t.$.dropDownHeader.contains(document.activeElement)&&("Enter"===a||" "===a)?(e.preventDefault(),t._dropDownHeaderClickHandler({target:document.activeElement})):"Escape"===a||e.altKey&&"ArrowUp"===a?(e.preventDefault(),t.close(),t.$.input.focus()):("Enter"===a||" "===a)&&document.activeElement.classList.contains("smart-footer-component-today")&&(e.preventDefault(),t._validateValue(t._now()))}_dropDownTransitionendHandler(){const e=this;e._edge&&!e.opened&&e.$.hasClass("animation")&&e.$dropDown.addClass("not-in-view")}_footerChangeHandler(e){const t=this,a=t.context,n=e.target,i=null===t._value?t._now():t._value;let l,o=n.value;if(t.context=t,e.stopPropagation(),n.classList.contains("smart-hour-element")){if(o=parseInt(o,10),isNaN(o)||0>o||12<o)return void(n.value=i.toString("hh"));0<o&&12>o&&"PM"===i.toString("tt")&&(o+=12),l="hh"}else if(n.classList.contains("smart-minute-element")){if(o=parseInt(o,10),isNaN(o)||0>o||59<o)return void(n.value=i.toString("mm"));l="mm"}else{if(null===t._value)return void(n.value="");const e=i.toString("tt");return o=o.toLowerCase(),void("PM"===e&&("a"===o||"am"===o)||"AM"===e&&("p"===o||"pm"===o)?(t._incrementDecrement(void 0,"tt"),n.value=t._value.toString("tt")):n.value=e)}const d=Smart.Utilities.DateTime.getConstructorParameters(i);d[t._codeToIndex[l]]=o,d.unshift(null),t._validateValue(new(Function.prototype.bind.apply(Smart.Utilities.DateTime,d))),n.value=t._value.toString(l),t.context=a}_footerClickHandler(e){const t=this,a=t.context,n=e.target;if(t.context=t,n.classList.contains("smart-today-element"))t._validateValue(t._now());else{const e=n.closest("smart-repeat-button");if(null!==e){const a=e.$.hasClass("smart-decrement-year-button"),n=e.closest(".smart-footer-component").classList.contains("smart-footer-component-hour")?"hh":"mm";t._incrementDecrement(a,n)}}t.context=a}_footerWheelHandler(e){const t=this;if(t.enableMouseWheelAction&&e.target instanceof HTMLInputElement&&document.activeElement===e.target){const a=t.context,n=e.target;t.context=t,n.classList.contains("smart-hour-element")?t._incrementDecrement(0<e.deltaY,"hh"):n.classList.contains("smart-minute-element")?t._incrementDecrement(0<e.deltaY,"mm"):t._incrementDecrement(void 0,"tt"),t.context=a,e.stopPropagation()}}_getAndHighlightTimePart(e,t,a){const n=this;n._programmaticSelection=!0,n.$.input.selectionStart!==e||n.$.input.selectionEnd!==t?n.$.input.setSelectionRange(e,t):setTimeout(function(){n.$.input.setSelectionRange(e,t)},200),n._highlightedTimePart={code:n._formatStringRegExp.groups[a],index:a,from:e,to:t}}_getFormatStringRegExp(){const e=this;e._formatStringRegExp=e.min.getParseRegExp(e.min.calendar,e.formatString.replace(/y+/g,"yyyyy")),e._formatStringRegExp.regExp=new RegExp(e._formatStringRegExp.regExp)}_getLocalizedNames(){const e=this,t=e.locale,a={names:[],namesAbbr:[],namesShort:[]},n={names:[],namesAbbr:[]};for(let e=23;30>e;e++){const n=new Date(2017,6,e),i=n.toLocaleString(t,{weekday:"long"});a.names.push(i),a.namesAbbr.push(n.toLocaleString(t,{weekday:"short"})),a.namesShort.push(i.substring(0,2))}for(let e=0;12>e;e++){const a=new Date(2017,e,1),i=a.toLocaleString(t,{month:"long"});n.names.push(i),n.namesAbbr.push(i.substring(0,3))}n.names.push(""),n.namesAbbr.push(""),e._localizedDays=a,e._localizedMonths=n,e.$.selectDate.innerHTML=e.localize("dateTabLabel"),e.$.selectTime.innerHTML=e.localize("timeTabLabel")}_handleManualTimePartEdit(e){const t=this,a=Smart.Utilities.DateTime.getConstructorParameters(t._value);if(e=e[t._highlightedTimePart.index+1],!isNaN(e))"f"===t._highlightedTimePart.code?e=100*parseInt(e):"ff"===t._highlightedTimePart.code?e=10*parseInt(e):-1!==t._highlightedTimePart.code.indexOf("y")&&3>e.length&&(e=a[0].toString().slice(0,2)+"0".repeat(2-e.length)+e),a[t._codeToIndex[t._highlightedTimePart.code]]=parseInt(e,10);else if(1===t._codeToIndex[t._highlightedTimePart.code]){let n=-1;if(1<e.length&&t._localizedMonths.names.some(function(t,a){if(-1!==t.toLowerCase().indexOf(e.toLowerCase()))return n=a,!0}),-1!==n)a[1]=n+1;else return void t._applyFormatString()}try{a.unshift(null),t._validateValue(new(Function.prototype.bind.apply(Smart.Utilities.DateTime,a)))}catch(e){t._applyFormatString()}}_highlightTimePartBasedOnCursor(e){const t=this,a=t.$.input.value,n=t._formatStringRegExp.regExp.exec(a);if(null===n)return void(t._highlightedTimePart=void 0);let l,o=n.index;e===void 0&&(e=t.$.input.selectionStart);for(let d=1;d<n.length;d++){const i=n[d];if(l=a.indexOf(i,o),o=l+i.length,1==d&&e<l){t._getAndHighlightTimePart(l,o,0);break}if(e>=l&&e<=o){t._getAndHighlightTimePart(l,o,d-1);break}const r=n[d+1];if(r){const n=a.indexOf(r,o);if(e>o&&e<n){e-o<=n-e?t._getAndHighlightTimePart(l,o,d-1):(t._formatStringRegExp.groups[d],t._programmaticSelection=!0,t.$.input.setSelectionRange(n,n+r.length));break}}else{t._programmaticSelection=!0,t.$.input.setSelectionRange(l,o),t._highlightedTimePart={code:t._formatStringRegExp.groups[d-1],index:d-1,from:l,to:o};break}}}_highlightTimePartBasedOnIndex(e){const t=this,a=t.$.input.value,n=t._formatStringRegExp.regExp.exec(a);let l,o=n.index;if(!(0>e||e>=n.length)){t.$.input!==document.activeElement&&t.$.input.focus();for(let d=1;d<n.length;d++){const i=n[d];if(l=a.indexOf(i,o),o=l+i.length,e===d-1){t._getAndHighlightTimePart(l,o,e);break}}}}_incrementDecrement(e,t){const a=this,n=a._cloneValue();if(void 0===t&&a._highlightedTimePart&&(t=a._highlightedTimePart.code),void 0!==t){if("z"===t||"zz"===t||"zzz"===t)return void a._highlightTimePartBasedOnIndex(a._highlightedTimePart.index);a._value="t"===t||"tt"===t?a._value.addHours(12>a._value.hour()?12:-12,!0):a._value[a._codeToMethod[t]](e?-1:1,!0),a._validateValue(void 0,n,!1),a._highlightedTimePart&&a._highlightTimePartBasedOnIndex(a._highlightedTimePart.index)}else a._value=a._value.add(e?a.interval.negate():a.interval,void 0,!0),a._validateValue(void 0,n,!1);0!==n.compare(a._value)&&a.$.fireEvent("change",{oldValue:n.toTimeZone(a._inputTimeZone),value:a.value})}_initializeTimePicker(){const e=this,t=document.createElement("smart-time-picker");t.theme=e.theme,t.value=null===e._value?e._now():e._value.toDate(),e.$.timePickerDropDown=t,t.$=Smart.Utilities.Extend(t),e.$.dropDownContent.appendChild(t),e._timePickerInitialized=!0,e._addTimePickerListener()}_inputBlurHandler(){const e=this;e.removeAttribute("focused"),e._fullEdit=!1,e._highlightedTimePartEdit=!1}_inputChangeHandler(e){const t=this;if(e&&e.stopPropagation(),""===t.$.input.value)return void t._setNullValue();if(t._fullEdit||null===t._value)t._fullEdit=!1,t._validateValue(t.$.input.value);else if(t._highlightedTimePartEdit){t._highlightedTimePartEdit=!1;let e=t._formatStringRegExp.regExp.exec(t.$.input.value);null===e?t._applyFormatString():t._handleManualTimePartEdit(e)}}_inputDragstartHandler(e){e.preventDefault()}_inputFocusHandler(){const e=this;e.setAttribute("focused",""),"full"!==e.editMode&&setTimeout(function(){!0!==e._mouseFocus&&(e._highlightedTimePart===void 0?e._highlightTimePartBasedOnCursor(0):e._highlightTimePartBasedOnIndex(e._highlightedTimePart.index))},0)}_inputKeydownHandler(e){const t=this,a=t.editMode,n=e.key;if("Tab"!==n){if(e.altKey&&"ArrowDown"===n)return e.preventDefault(),void t.open();if("Escape"===n||e.altKey&&"ArrowUp"===n)return e.preventDefault(),void t.close();if("full"===a)return void(t._fullEdit=!0);if("partial"===a){if("Delete"===n)return void(null!==t._value&&(t._setNullValue(),e.preventDefault()));if(null===t._value&&(t._validateValue(t._now(),null,!1),t._highlightTimePartBasedOnIndex(0)),-1!==["/",".","-",","," "].indexOf(n))return t._inputChangeHandler(),t._navigateToNextTimePart(),void e.preventDefault();if("Backspace"===n)return t._resetTimePart(),0<t._highlightedTimePart.index?t._navigateToPreviousTimePart():t._highlightTimePartBasedOnIndex(0),void e.preventDefault()}else if(t._fullEdit||t._highlightedTimePartEdit||t.readonly||-1!==["Alt","Control","Shift"].indexOf(n)||e.altKey||e.ctrlKey)return;if(-1===["End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].indexOf(n)){if(t._highlightedTimePart){if("partial"!==a&&t._highlightedTimePart.to-t._highlightedTimePart.from!=t.$.input.selectionEnd-t.$.input.selectionStart)return void(t._fullEdit=!0);const i=t._highlightedTimePart.code;if("ddd"===i||"dddd"===i||"z"===i||"zz"===i||"zzz"===i||"t"===i||"tt"===i)return void e.preventDefault();if("partial"===a&&"MMM"!==i&&"MMMM"!==i&&!1===new RegExp(/^\d+$/).digits.test(n))return void((2>n.length||"F"!==n.charAt(0))&&e.preventDefault());t._highlightedTimePartEdit=!0}return}(e.preventDefault(),"partial"===a&&t._highlightedTimePartEdit&&t._inputChangeHandler(),null===t._value)||("End"===n?t._highlightTimePartBasedOnIndex(t._formatStringRegExp.groups.length-1):"Home"===n?t._highlightTimePartBasedOnIndex(0):"ArrowLeft"===n?t._navigateToPreviousTimePart():"ArrowUp"===n?t._incrementDecrement():"ArrowRight"===n?t._navigateToNextTimePart():"ArrowDown"===n?t._incrementDecrement(!0):void 0)}}_inputMousedownHandler(){const e=this;e._fullEdit||e._highlightedTimePartEdit||"full"===e.editMode||setTimeout(function(){e._mouseFocus=!0,e._highlightTimePartBasedOnCursor()},0)}_inputPasteHandler(e){const t=this;"partial"===t.editMode?e.preventDefault():this._fullEdit=!0}_inputSelectHandler(){const e=this;"partial"!==e.editMode||(!0===e._programmaticSelection?e._programmaticSelection=!1:e._highlightedTimePart?e._highlightTimePartBasedOnIndex(e._highlightedTimePart.index):e._highlightTimePartBasedOnIndex(0))}_inputWheelHandler(e){const t=this;document.activeElement!==t.$.input||!t.enableMouseWheelAction||t.disabled||t.readonly||(e.preventDefault(),t._incrementDecrement(0<e.deltaY))}_isRestricted(e){const t=this.restrictedDates;let a=!1;for(let n=0;n<t.length;n++)if(e.equalDateParts(t[n])){a=!0;break}return a}_mouseoutHandler(e){const t=this;t.disabled||e.target!==t.$.input&&e.target!==t.$.calendarButton||e.target.$.removeClass("hover")}_mouseoverHandler(e){const t=this;t.disabled||e.target!==t.$.input&&e.target!==t.$.calendarButton||e.target.$.addClass("hover")}_navigateToNextTimePart(){const e=this;e._highlightTimePartBasedOnIndex(e._highlightedTimePart.index+1)}_navigateToPreviousTimePart(){const e=this;e._highlightTimePartBasedOnIndex(e._highlightedTimePart.index-1)}_now(){const e=this,t=new Smart.Utilities.DateTime("today","Local");return"Local"===e._outputTimeZone?t:t.toTimeZone(e._outputTimeZone)}_open(){const e=this;if(e.disabled||e.readonly)return void(e.opened=!1);const t=e.$.fireEvent("opening");if(!t.defaultPrevented){if(e._edge&&e.$dropDown.removeClass("not-in-view"),e.$.dropDown.style.transition="",e.$.calendarDropDown.disabled=!1,e.$calendarButton.addClass("smart-calendar-button-pressed"),("default"!==e.dropDownDisplayMode&&"timePicker"!==e.dropDownDisplayMode||!e._timePickerInitialized||e._timePickerInitialized&&e.$.timePickerDropDown.$.hasClass("smart-hidden"))&&e.$calendarDropDown.removeClass("smart-hidden"),e.$dropDown.removeClass("smart-visibility-hidden"),e.opened=!0,e.$.fireEvent("open"),e._toSync){const t=e._value;if(null!==t)e._disregardCalendarChangeEvent=!0,e.$.calendarDropDown.selectedDates=[t.toDate()],e._defaultFooterTemplateApplied&&(e._hourElement.value=t.toString("hh"),e._minuteElement.value=t.toString("mm"),e._ampmElement.value=t.toString("tt")),e._timePickerInitialized&&(e.$.timePickerDropDown.value=t.toDate());else{const t=e.$.calendarDropDown.context;e.$.calendarDropDown.context=e.$.calendarDropDown,e.$.calendarDropDown._clearSelection(!0),e.$.calendarDropDown.context=t,e._defaultFooterTemplateApplied&&(e._hourElement.value="",e._minuteElement.value="",e._ampmElement.value="")}e._toSync=!1}switch(e.dropDownDisplayMode){case"default":e.$.selectDate.focus();break;case"classic":case"calendar":e.$.calendarDropDown.focus();break;case"timePicker":e.$.timePickerDropDown.$.picker.focus();}}else e.opened=!1}_rangeValidation(e){const t=this;return-1===e.compare(t.min)?t.min.clone():1===e.compare(t.max)?t.max.clone():e}_resetTimePart(){const e=this,t=e._highlightedTimePart.code,a=e._codeToIndex[t],n=Smart.Utilities.DateTime.getConstructorParameters(e._value);let i;i=2<a?0:0<a?1:e.min.year(),n[a]=i,n.unshift(null),e._validateValue(new(Function.prototype.bind.apply(Smart.Utilities.DateTime,n)))}_setDefaultFooterTemplate(e){const t=this;t.$.calendarDropDown.footerTemplate=t._defaultFooterTemplate,e&&t.$.calendarDropDown._handleLayoutTemplate(t.$.calendarDropDown.$.footer,t._defaultFooterTemplate),t._hourElement=t.$.calendarDropDown.getElementsByClassName("smart-hour-element")[0],t._minuteElement=t.$.calendarDropDown.getElementsByClassName("smart-minute-element")[0],t._ampmElement=t.$.calendarDropDown.getElementsByClassName("smart-am-pm-element")[0],t._todayElement=t.$.calendarDropDown.getElementsByClassName("smart-today-element")[0],t._todayElement.title=t.localize("now"),t._addCalendarFooterListeners(),t._defaultFooterTemplateApplied=!0}_setFocusable(){const e=this;if(e.disabled||e.unfocusable)return e.$.input.tabIndex=-1,e.$.selectDate.removeAttribute("tabindex"),e.$.selectTime.removeAttribute("tabindex"),void(e._defaultFooterTemplateApplied&&(e._hourElement.tabIndex=-1,e._ampmElement.tabIndex=-1,e._minuteElement.tabIndex=-1,e.$.calendarDropDown.getElementsByClassName("smart-increment-year-button")[0].tabIndex=-1,e.$.calendarDropDown.getElementsByClassName("smart-increment-year-button")[1].tabIndex=-1,e.$.calendarDropDown.getElementsByClassName("smart-decrement-year-button")[0].tabIndex=-1,e.$.calendarDropDown.getElementsByClassName("smart-decrement-year-button")[1].tabIndex=-1,e.$.calendarDropDown.getElementsByClassName("smart-footer-component-today")[0].tabIndex=-1));const t=0<e.tabIndex?e.tabIndex:0;e.$.input.removeAttribute("tabindex"),e.$.selectDate.tabIndex=t,e.$.selectTime.tabIndex=t,e._defaultFooterTemplateApplied&&(e._hourElement.removeAttribute("tabindex"),e._ampmElement.removeAttribute("tabindex"),e._minuteElement.removeAttribute("tabindex"),e.$.calendarDropDown.getElementsByClassName("smart-increment-year-button")[0].removeAttribute("tabindex"),e.$.calendarDropDown.getElementsByClassName("smart-increment-year-button")[1].removeAttribute("tabindex"),e.$.calendarDropDown.getElementsByClassName("smart-decrement-year-button")[0].removeAttribute("tabindex"),e.$.calendarDropDown.getElementsByClassName("smart-decrement-year-button")[1].removeAttribute("tabindex"),e.$.calendarDropDown.getElementsByClassName("smart-footer-component-today")[0].tabIndex=t)}_setNullValue(e){const t=this;if(void 0===e&&(e=t._cloneValue()),t.nullable){if(t._value=null,t.value=null,t._highlightedTimePart=void 0,t.$.input.value="",null!==e){if(t.opened){if(!t._calendarInitiatedChange){const e=t.$.calendarDropDown.context;t.$.calendarDropDown.context=t.$.calendarDropDown,t.$.calendarDropDown._clearSelection(!0),t.$.calendarDropDown.context=e}t._defaultFooterTemplateApplied&&(t._hourElement.value="",t._ampmElement.value="",t._minuteElement.value=""),t._toSync=!1}else t._toSync=!0;t.$.fireEvent("change",{oldValue:e.toTimeZone(t._inputTimeZone),value:null})}t._disableSpinButtons()}else t._validateValue(t._now(),e)}_spinButtonsClickHandler(e){const t=this;null===t._value||t.disabled||t.readonly||t._incrementDecrement(!(e.target!==t.$.downButton))}_validateInitialPropertyValues(){const e=this,t=e.$.calendarDropDown;"left"===e.calendarButtonPosition&&e.$.content.insertBefore(e.$.calendarButton,e.$.input),"left"===e.spinButtonsPosition&&e.$.content.insertBefore(e.$.spinButtonsContainer,e.$.input),e.disabled&&(e.$.upButton.disabled=!0,e.$.downButton.disabled=!0),e.opened&&(e.disabled||e.readonly?e.opened=!1:(t.disabled=!1,e.$calendarButton.addClass("smart-calendar-button-pressed"),e.$calendarDropDown.removeClass("smart-hidden"),e.$dropDown.removeClass("smart-visibility-hidden"))),null===e.footerTemplate?e._setDefaultFooterTemplate(!0):(t.footerTemplate=e.footerTemplate,t._handleLayoutTemplate(t.$.footer,e.footerTemplate)),""===e.formatString&&(e.formatString="dd-MMM-yy HH:mm:ss.fff");const a=e.displayKind;"UTC"===a?e._outputTimeZone="UTC":"local"===a&&(e._outputTimeZone="Local");let n;if(null===e.value?(n=null,e._inputTimeZone="Local"):(n=Smart.Utilities.DateTime.validateDate(e.value,new Smart.Utilities.DateTime,e.formatString),e._inputTimeZone=n.timeZone,"unspecified"!==a&&e._inputTimeZone!==e._outputTimeZone?n=n.toTimeZone(e._outputTimeZone):"unspecified"===a&&(e._outputTimeZone=e._inputTimeZone)),e._validateRestrictedDates(),e._validateMinMax("both"),e._validateValue(n,e._now(),!1),e._validateInterval(new Smart.Utilities.TimeSpan(0,0,1)),e._getFormatStringRegExp(),e._defaultFooterTemplateApplied&&""===e._hourElement.value&&null!==e.value){const t=e.value;e._hourElement.value=t.toString("hh"),e._ampmElement.value=t.toString("tt"),e._minuteElement.value=t.toString("mm")}const i=e.dropDownDisplayMode;"default"===i||"calendar"===i?(t.viewSections=["title","header"],t.$title.hasClass("smart-hidden")&&t.propertyChangedHandler("viewSections",["header","footer"],["title","header"]),"default"===i&&e.$dropDownHeader.removeClass("smart-hidden")):"timePicker"===i&&(e.$calendarDropDown.addClass("smart-hidden"),e._initializeTimePicker())}_validateInterval(e){const t=this,a=t.interval;let n=a;if(a instanceof Smart.Utilities.TimeSpan)n=a;else if("string"==typeof a){const i=a.indexOf("TimeSpan("),l=a.indexOf(")");if(-1!==i&&-1!==l&&(n=a.slice(i+9,l),n=n.replace(/'/g,"").replace(/"/g,"").replace(/^\s+|\s+$|\s+(?=\s)/g,""),new RegExp(/(^(\d+)(,\s*\d+)*$)/g).test(n)&&(n=n.replace(/\s/g,""),n=n.split(","),n.map(function(e,t){n[t]=parseInt(e)}),n.unshift(null),n=new(Function.prototype.bind.apply(Smart.Utilities.TimeSpan,n)))),!1==n instanceof Smart.Utilities.TimeSpan){if(""===n.trim())return void(t.interval=e);isNaN(n)||(n=1e4*parseInt(n,10));try{n=new Smart.Utilities.TimeSpan(n)}catch(a){return void(t.interval=e)}}}else if("number"==typeof a)n=new Smart.Utilities.TimeSpan(a);else return void(t.interval=e);t.interval=0===n._ticks?e:n}_validateMinMax(e,t){const a=this;let n=!1;"max"!==e&&(a.min=Smart.Utilities.DateTime.validateDate(a.min,t||new Smart.Utilities.DateTime(1600,1,1),a.formatString),a.min=a.min.toTimeZone(a._outputTimeZone),n=!0),"min"!==e&&(a.max=Smart.Utilities.DateTime.validateDate(a.max,t||new Smart.Utilities.DateTime(3001,1,1),a.formatString),a.max=a.max.toTimeZone(a._outputTimeZone),a.max.calendar.days=a._localizedDays,a.max.calendar.months=a._localizedMonths,a.max.calendar.locale=a.locale,a.$.calendarDropDown.max=a.max.toDate()),0<a.min.compare(a.max)&&(a.min=a.max.clone(),n=!0),n&&(a.min.calendar.days=a._localizedDays,a.min.calendar.months=a._localizedMonths,a.min.calendar.locale=a.locale,a.$.calendarDropDown.min=a.min.toDate())}_validateRestrictedDates(){const e=this,t=[],a=[];for(let n=0;n<e.restrictedDates.length;n++){const i=e.restrictedDates[n];let l=Smart.Utilities.DateTime.validateDate(i,"invalid",e.formatString);"invalid"!==l&&(l=l.toTimeZone(e._outputTimeZone),t.push(l),a.push(l.toDate()))}e.restrictedDates=t,e.$.calendarDropDown.restrictedDates=a}_validateValue(e,t,a){const n=this,i=void 0===t?n._cloneValue():t;if(null===e||""===e)return void n._setNullValue(i);if(void 0!==e&&(n._value=Smart.Utilities.DateTime.validateDate(e,i,n.formatString)),null===n._value)return void n._setNullValue(i);let l=n._value;for(;!0===n._isRestricted(l);)l.addDays(1,!1);n._value=n._rangeValidation(l),n.value=n._value.toTimeZone(n._inputTimeZone);const o=n._value;if(o.calendar.days=n._localizedDays,o.calendar.months=n._localizedMonths,o.calendar.locale=n.locale,n._applyFormatString(),n._disableSpinButtons(),(null===i||null===o)&&i!==o||null!==i&&null!==o&&0!==i.compare(o)){if(!1!==a&&n.$.fireEvent("change",{oldValue:null===i?null:i.toTimeZone(n._inputTimeZone),value:n.value}),n._calendarInitiatedChange)return;n.opened?((null===i||0===n.$.calendarDropDown.selectedDates.length||i.year()!==o.year()||i.month()!==o.month()||i.day()!==o.day())&&(n._disregardCalendarChangeEvent=!0,n.$.calendarDropDown.selectedDates=[o.toDate()]),n._defaultFooterTemplateApplied&&((null===i||i.hour()!==o.hour())&&(n._hourElement.value=o.toString("hh"),n._ampmElement.value=o.toString("tt")),(null===i||i.minute()!==o.minute())&&(n._minuteElement.value=o.toString("mm"))),n._timePickerInitialized&&!n._timePickerInitiatedChange&&(n.$.timePickerDropDown.value=o.toDate()),n._toSync=!1):n._toSync=!0}}});