
/* Smart HTML Elements v1.1.0 (2018-June) 
Copyright (c) 2011-2018 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-time-picker",class extends Smart.BaseElement{static get properties(){return{autoSwitchToMinutes:{value:!1,type:"boolean"},footer:{value:!1,type:"boolean"},footerTemplate:{value:null,type:"any?"},format:{value:"12-hour",allowedValues:["12-hour","24-hour"],type:"string"},minuteInterval:{value:1,type:"number"},name:{value:"",type:"string"},selection:{value:"hour",allowedValues:["hour","minute"],type:"string"},value:{value:new Date,type:"any"},view:{value:"portrait",allowedValues:["landscape","portrait"],type:"string"}}}static get listeners(){return{keydown:"_keydownHandler",resize:"_resizeHandler","header.click":"_headerClickHandler","picker.down":"_pickerDownHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler"}}static get requires(){return{"Smart.Utilities.NumericProcessor":"smart.numeric.js","Smart.Utilities.BigNumber":"smart.math.js","Smart.Utilities.Draw":"smart.draw.js"}}template(){return"<div id=\"container\">\n                <div id=\"header\" class=\"smart-header smart-unselectable\">\n                    <div id=\"hourMinuteContainer\" class=\"smart-hour-minute-container\">\n                        <div id=\"hourContainer\" class =\"smart-hour-container\"></div>\n                        <div>:</div>\n                        <div id=\"minuteContainer\" class=\"smart-minute-container\"></div>\n                    </div>\n                    <div id=\"ampmContainer\" class=\"smart-am-pm-container\">\n                        <div id=\"amContainer\" class=\"smart-am-container\">AM</div>\n                        <div id=\"pmContainer\" class=\"smart-pm-container\">PM</div>\n                    </div>\n                </div>\n                <div id=\"main\" class=\"smart-main-container\">\n                    <div id=\"svgContainer\" class=\"smart-svg-container\">\n                        <div id=\"picker\" class=\"smart-svg-picker\"></div>\n                    </div>\n                    <div id=\"footer\" class=\"smart-footer\"></div>\n                </div>\n                <input id=\"hiddenInput\" type=\"hidden\" name=\"[[name]]\">\n            </div>"}ready(){super.ready(),this._createElement()}setHours(a,b){const c=this;a=24===a?0:Math.max(0,Math.min(a,23)),12>a?c._selectAmPm("am"):c._selectAmPm("pm"),"12-hour"===c.format&&(0===a?a=12:12<a&&(a-=12)),c._updateHours(a,b),"hour"===c.selection&&("24-hour"===c.format&&(0===a||12<a)&&(c._inInnerCircle=!0),c._drawArrow(!0,a),c._inInnerCircle=!1)}setMinutes(a){const b=this;a=60===a?0:Math.max(0,Math.min(a,59)),b._updateMinutes(a),"minute"===b.selection&&b._drawArrow(!0,a)}propertyChangedHandler(a,b,c){super.propertyChangedHandler(a,b,c);const d=this;switch(a){case"disabled":case"unfocusable":d._setFocusable();break;case"footer":case"view":d._resizeHandler();break;case"footerTemplate":d._validateFooterTemplate();break;case"format":{let a=d.value.getHours();"12-hour"===c?(d.$ampmContainer.removeClass("smart-hidden"),12>d.value.getHours()?d._selectAmPm("am"):d._selectAmPm("pm"),0===a?a=12:12<a&&(a-=12)):d.$ampmContainer.addClass("smart-hidden"),d.$.hourContainer.innerHTML=a,"hour"===d.selection&&(d._draw.clear(),d._renderSVG());break}case"minuteInterval":{const a=Math.max(1,Math.min(c,60));a!==c&&(d.minuteInterval=a),"minute"===d.selection&&(d.interval=a);break}case"selection":"hour"===c?d._changeToHourSelection():d._changeToMinuteSelection();break;case"value":{d._oldValue=b,d._validateValue();const a=d.value.getHours()===b.getHours(),c=d.value.getMinutes()===b.getMinutes();if(!(a&&c)){if(c)return void d.setHours(d.value.getHours());a||d.setHours(d.value.getHours(),!0),d.setMinutes(d.value.getMinutes())}delete d._oldValue;break}}}_applyInitialSettings(){const a=this,b=a.value;let c,d;c=b.getHours(),d=b.getMinutes(),"12-hour"===a.format?12>c?(a._ampm="am",a.$amContainer.addClass("smart-selected"),0===c&&(c=12)):(a._ampm="pm",a.$pmContainer.addClass("smart-selected"),12<c&&(c-=12)):a.$ampmContainer.addClass("smart-hidden"),d=d.toString(),1===d.length&&(d="0"+d),a.$.hourContainer.innerHTML=c,a.$.minuteContainer.innerHTML=d,"hour"===a.selection?a.$hourContainer.addClass("smart-selected"):a.$minuteContainer.addClass("smart-selected")}_changeSelection(a){var b=Math.pow;const c=this,d=a.pageX,e=a.pageY,f=c._getCenterCoordinates(),g=Math.sqrt(b(f.x-d,2)+b(f.y-e,2));if(c._measurements.center=f,"down"===a.type){if(g>c._measurements.radius)return void a.stopPropagation();c._dragging=!0}c._inInnerCircle=!!("24-hour"===c.format&&"hour"===c.selection&&g<c._measurements.radius-50);const h=Math.atan2(e-f.y,d-f.x);let i=180*(-1*h)/Math.PI;0>i&&(i+=360),c._angle=i;let j=c._numericProcessor.getValueByAngle(c._angle);"hour"===c.selection?("24-hour"===c.format?c._inInnerCircle?0!==j&&12!==j?j+=12:j=0:0===j&&(j=12):0===j&&(j=12),c._updateHours(j)):(60===j&&(j=0),c._updateMinutes(j)),c._drawArrow(!0,j)}_changeToHourSelection(){const a=this,b=a._centralCircle.parentElement||a._centralCircle.parentNode;a.interval=1,a.$hourContainer.addClass("smart-selected"),a.$minuteContainer.removeClass("smart-selected"),b.removeChild(a._centralCircle),b.removeChild(a._arrow),b.removeChild(a._head),a._getMeasurements(),a._numericProcessor.getAngleRangeCoefficient(),a._draw.clear(),b.appendChild(a._centralCircle),b.appendChild(a._arrow),b.appendChild(a._head),a._renderHours(),"24-hour"===a.format&&(0===a.value.getHours()||12<a.value.getHours())&&(a._inInnerCircle=!0),a._drawArrow(!0),a._inInnerCircle=!1}_changeToMinuteSelection(){const a=this,b=a._centralCircle.parentElement||a._centralCircle.parentNode;a.interval=a.minuteInterval,a.$hourContainer.removeClass("smart-selected"),a.$minuteContainer.addClass("smart-selected"),b.removeChild(a._centralCircle),b.removeChild(a._arrow),b.removeChild(a._head),a._getMeasurements(),a._numericProcessor.getAngleRangeCoefficient(),a._draw.clear(),b.appendChild(a._centralCircle),b.appendChild(a._arrow),b.appendChild(a._head),a._renderMinutes(),a._drawArrow(!0)}_computeArrowBodyPoints(a,b,c,d){const e=this,f=Math.sin(b),g=Math.cos(b),h=a-c*g+d*f,i=a+c*f+d*g,j=a+c*g+d*f,k=a-c*f+d*g;return e._headCenter={x:(h+j)/2,y:(i+k)/2},"M "+(a+c*g)+","+(a-c*f)+" L "+(a-c*g)+","+(a+c*f)+" L "+h+","+i+" "+j+","+k}_createElement(){const a=this;return a.coerce=!0,a.min=0,a._drawMin="0",a.startAngle=-270,a.endAngle=90,a._angleDifference=a.endAngle-a.startAngle,a.ticksVisibility="none",a._tickIntervalHandler={},a._tickIntervalHandler.labelsSize={},a._distance={majorTickDistance:0,minorTickDistance:0,labelDistance:10},a._measurements={},a._validateInitialPropertyValues(),a._applyInitialSettings(),a._numericProcessor=new Smart.Utilities.DecimalNumericProcessor(a),a._draw=new Smart.Utilities.Draw(a.$.picker),a._isVisible()?void(a._setPickerSize(),a._getMeasurements(),a._numericProcessor.getAngleRangeCoefficient(),a._renderSVG(),a._setFocusable()):void(a._renderingSuspended=!0)}_documentMoveHandler(a){const b=this;b._dragging&&b._changeSelection(a)}_documentUpHandler(){const a=this;a._dragging&&(a._inInnerCircle=!1,a._dragging=!1,a.autoSwitchToMinutes&&"hour"===a.selection&&(a.$picker.addClass("animate"),setTimeout(function(){a.selection="minute",a._changeToMinuteSelection()},250),setTimeout(function(){a.$picker.removeClass("animate")},550)))}_drawArrow(a,b){const c=this,d=c._measurements;b===void 0&&("hour"===c.selection?(b=c.value.getHours(),"12-hour"===c.format&&12<b&&(b-=12)):b=c.value.getMinutes());const e=c._numericProcessor.getAngleByValue(b);let f;f=c._inInnerCircle?c._computeArrowBodyPoints(d.radius,e,1,d.innerRadius-c._largestLabelSize/2-45):c._computeArrowBodyPoints(d.radius,e,1,d.innerRadius-c._largestLabelSize/2),a?(c._arrow.setAttribute("d",f),c._head.setAttribute("cx",c._headCenter.x),c._head.setAttribute("cy",c._headCenter.y),c._head.setAttribute("r",c._largestLabelSize),c._headRect=c._head.getBoundingClientRect(),c._highlightLabel(b)):(c._arrow=c._draw.path(f,{class:"smart-needle"}),c._head=c._draw.circle(c._headCenter.x,c._headCenter.y,c._largestLabelSize,{class:"smart-needle-central-circle"}),c._headRect=c._head.getBoundingClientRect())}_drawLabel(a,b,c){var d=Math.round;const e=this,f=e._measurements,g=f.radius,h={class:"smart-label smart-unselectable","font-size":f.fontSize,"font-family":f.fontFamily,"font-weight":f.fontWeight,"font-style":f.fontStyle};"hour"===e.selection?e._plotInnerCircle?0<b?b+=12:b="00":0===b&&(b=12):1===b.toString().length&&(b="0"+b);const i=e._draw.measureText(b,0,h),j=g-c-e._largestLabelSize/2,k=g+j*Math.sin(a),l=g+j*Math.cos(a),m=e._draw.text(b,d(k)-i.width/2,d(l)-i.height/2,i.width,i.height,0,h);m.setAttribute("value",parseFloat(b))}_getCenterCoordinates(){const a=this,b=a.$.picker.getBoundingClientRect(),c=a._measurements.radius,d=document.body.scrollLeft||document.documentElement.scrollLeft,e=document.body.scrollTop||document.documentElement.scrollTop;return{x:b.left+d+c,y:b.top+e+c}}_getMeasurements(){const a=this,b=a._measurements,c=document.createElement("div");let d,e,f,g,h,i;c.className="smart-label",c.style.position="absolute",c.style.visibility="hidden",a.$.svgContainer.appendChild(c),"hour"===a.selection?(d="1",e="23",a.max=12,a._drawMax="12",a._range=12):(d="00",e="55",a.max=60,a._drawMax="60",a._range=60),c.innerHTML=d,f=c.offsetWidth,h=c.offsetHeight,c.innerHTML=e,g=c.offsetWidth,i=c.offsetHeight,a._largestLabelSize=Math.max(f,h,g,i),a._tickIntervalHandler.labelsSize.minLabelSize=h,a._tickIntervalHandler.labelsSize.maxLabelSize=i;const j=window.getComputedStyle(c);b.fontSize=j.fontSize,b.fontFamily=j.fontFamily,b.fontWeight=j.fontWeight,b.fontStyle=j.fontStyle,a.$.svgContainer.removeChild(c)}_headerClickHandler(a){const b=this;if(!(b.disabled||b.readonly))switch(a.target){case b.$.hourContainer:"hour"!==b.selection&&(b.selection="hour",b._changeToHourSelection());break;case b.$.minuteContainer:"minute"!==b.selection&&(b.selection="minute",b._changeToMinuteSelection());break;case b.$.amContainer:if(!b.$amContainer.hasClass("smart-selected")){b._selectAmPm("am");const a=new Date(b.value.getTime());b.value.setHours(b.value.getHours()-12),b.$.hiddenInput.value=b.value,b.$.fireEvent("change",{value:b.value,oldValue:a})}break;case b.$.pmContainer:if(!b.$pmContainer.hasClass("smart-selected")){b._selectAmPm("pm");const a=new Date(b.value.getTime());b.value.setHours(b.value.getHours()+12),b.$.hiddenInput.value=b.value,b.$.fireEvent("change",{value:b.value,oldValue:a})}}}_highlightLabel(a){const b=this;if(b._highlightedLabel){if(parseFloat(b._highlightedLabel.getAttribute("value"))===a)return;b._highlightedLabel.classList.remove("smart-selected"),b._highlightedLabel=void 0}let c;"hour"===b.selection?(a===void 0&&(a=b.value.getHours()),"12-hour"===b.format&&(0===a?a=12:12<a&&(a-=12)),c=a):(a===void 0&&(a=b.value.getMinutes()),c=5*Math.round(a/5),60===c&&(c=0));const d=b.$.picker.querySelector(".smart-label[value=\""+c+"\"]");(c===a||b._overlapsLabel(d))&&(b._highlightedLabel=d,d.classList.add("smart-selected"))}_isVisible(){const a=this;return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)}_keydownHandler(a){const b=this,c=document.activeElement,d=a.key;if(b.$.header.contains(c)&&("Enter"===d||" "===d))a.preventDefault(),b._headerClickHandler({target:c});else if(c===b.$.picker&&!a.altKey){let c;if("ArrowRight"===d||"ArrowUp"===d?c=1:("ArrowLeft"===d||"ArrowDown"===d)&&(c=-1),c)if(a.preventDefault(),"hour"===b.selection){let a=b.value.getHours();0===a&&-1===c?a=23:23===a&&1===c?a=0:a+=c,"12-hour"===b.format&&(12<=a&&b.$amContainer.hasClass("smart-selected")?a-=12:12>a&&b.$pmContainer.hasClass("smart-selected")&&(a+=12)),b.setHours(a)}else{let a=b.value.getMinutes();c*=b.minuteInterval,60<=a+c?a=0:a<-1*c?0==60%c?a=60+c:a=60-60%c:a+=c,b.setMinutes(a)}}}_overlapsLabel(a){const b=this,c=a.getBoundingClientRect(),d=b._headRect,e=!(c.right-10<d.left||c.left+10>d.right||c.bottom-10<d.top||c.top+10>d.bottom);return e}_parseDateString(a,b){const c=a.indexOf("Date("),d=a.indexOf(")");let e=a;if(-1!==c&&-1!==d){if(e=a.slice(c+5,d),e=e.replace(/'/g,"").replace(/"/g,"").replace(/^\s+|\s+$|\s+(?=\s)/g,""),""===e.trim())return new Date;if(new RegExp(/(^(\d+)(\s*,\s*\d+)+$)/g).test(e))return e=e.replace(/\s/g,""),e=e.split(","),e.map(function(a,b){e[b]=parseInt(a)}),e.unshift(null),e=new(Function.prototype.bind.apply(Date,e)),e}if(""===e.trim())return b;if(!isNaN(e))return new Date(parseInt(e,10));try{e=new Date(e)}catch(a){e=b}return e}_pickerDownHandler(a){const b=this;b.disabled||b.readonly||"buttons"in a&&1!==a.buttons||1!==a.which||b._changeSelection(a)}_renderHours(){const a=this;a._highlightedLabel=void 0,a._majorTicksInterval=1,a._numericProcessor.addGaugeTicksAndLabels(),"24-hour"===a.format&&(a._plotInnerCircle=!0,a._distance.labelDistance=55,a._numericProcessor.addGaugeTicksAndLabels(),a._plotInnerCircle=!1,a._distance.labelDistance=10)}_renderMinutes(){const a=this;a._highlightedLabel=void 0,a._majorTicksInterval=5,a._numericProcessor.addGaugeTicksAndLabels()}_renderSVG(){const a=this;if(!a._isVisible()||a._renderingSuspended)return void(a._renderingSuspended=!0);if(a._centralCircle=a._draw.circle(a._measurements.radius,a._measurements.radius,4,{class:"smart-needle-central-circle"}),"hour"===a.selection&&"24-hour"===a.format&&(0===a.value.getHours()||12<a.value.getHours())&&(a._inInnerCircle=!0),a._drawArrow(!1),a._inInnerCircle=!1,"hour"===a.selection){a.interval=1,a._renderHours();let b=a.value.getHours();"12-hour"===a.format&&12<b&&(b-=12),a._highlightLabel(b)}else a.interval=a.minuteInterval,a._renderMinutes(),a._highlightLabel(a.value.getMinutes())}_resizeHandler(){const a=this;let b=!1;if(!a._isVisible())return void(a._renderingSuspended=!0);a._renderingSuspended=!1,b=!0,a._getMeasurements(),a._numericProcessor.getAngleRangeCoefficient();a._setPickerSize(),a._sizeChanged||b?(a._draw.clear(),a._renderSVG(),a._sizeChanged=!1):(a._headRect=a._head.getBoundingClientRect(),a._highlightLabel())}_selectAmPm(a){const b=this;"am"===a?(b._ampm="am",b.$pmContainer.removeClass("smart-selected"),b.$amContainer.addClass("smart-selected")):(b._ampm="pm",b.$amContainer.removeClass("smart-selected"),b.$pmContainer.addClass("smart-selected"))}_setFocusable(){const a=this;if(a.disabled||a.unfocusable)return a.$.hourContainer.removeAttribute("tabindex"),a.$.minuteContainer.removeAttribute("tabindex"),a.$.amContainer.removeAttribute("tabindex"),a.$.pmContainer.removeAttribute("tabindex"),void a.$.picker.removeAttribute("tabindex");const b=0<a.tabIndex?a.tabIndex:0;a.$.hourContainer.tabIndex=b,a.$.minuteContainer.tabIndex=b,a.$.amContainer.tabIndex=b,a.$.pmContainer.tabIndex=b,a.$.picker.tabIndex=b}_setPickerSize(){const a=this,b=a.$.svgContainer.offsetWidth,c=a.$.svgContainer.offsetHeight;let d=.9*Math.min(b,c);a._sizeChanged=!(void 0===a._pickerSize||a._pickerSize===d),a._pickerSize=d,a._measurements.radius=d/2,a._measurements.innerRadius=a._measurements.radius-10,d+="px",a.$.picker.style.width=d,a.$.picker.style.height=d}_updateHours(a,b){const c=this;let d=a;"12-hour"===c.format?"am"===c._ampm?12===d&&(d=0):12>d&&(d+=12):d=a;const e=c._oldValue===void 0?new Date(c.value.getTime()):c._oldValue,f=e.getHours();d===f||(c._oldValue===void 0&&c.value.setHours(d),c.$.hourContainer.innerHTML=a,!0!==b&&(c.$.hiddenInput.value=c.value,c.$.fireEvent("change",{value:c.value,oldValue:e})))}_updateMinutes(a){const b=this,c=b._oldValue===void 0?new Date(b.value.getTime()):b._oldValue,d=c.getMinutes();a===d||(b._oldValue===void 0&&b.value.setMinutes(a),a=a.toString(),1===a.length&&(a="0"+a),b.$.minuteContainer.innerHTML=a,b.$.hiddenInput.value=b.value,b.$.fireEvent("change",{value:b.value,oldValue:c}))}_validateFooterTemplate(){const a=this,b=a.footerTemplate;if(null===b)return void(a.$.footer.innerHTML="");let c;if(b instanceof HTMLTemplateElement?c=b:"string"==typeof b&&(c=document.getElementById(b),!(c instanceof HTMLTemplateElement)&&(c=void 0)),void 0===c)return a.footerTemplate=null,void(a.$.footer.innerHTML="");const d=document.importNode(c.content,!0);a.$.footer.appendChild(d)}_validateInitialPropertyValues(){const a=this;a._validateFooterTemplate(),a.minuteInterval=Math.max(1,Math.min(a.minuteInterval,60)),a._validateValue()}_validateValue(){const a=this,b=a.value,c=a._oldValue===void 0?new Date:this._oldValue;b instanceof Date||(a.value="string"==typeof b?a._parseDateString(b,c):c)}});